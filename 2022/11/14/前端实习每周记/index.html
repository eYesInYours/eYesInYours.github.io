
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>前端实习每周记 - 小书斋</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="用来分享平日接触到的有意思的知识,1

第一周（2022&amp;#x2F;11&amp;#x2F;14 - 11&amp;#x2F;18）Monday
 
加飞书、企业微信

 
了解类似的两个微信小程序
横向scroll-view

issue：子元素,"> 
    <meta name="author" content="ikchen"> 
    <link rel="alternative" href="atom.xml" title="小书斋" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
    
    
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:title" content="前端实习每周记 - 小书斋"/>
    <meta name="twitter:description" content="用来分享平日接触到的有意思的知识,1

第一周（2022&amp;#x2F;11&amp;#x2F;14 - 11&amp;#x2F;18）Monday
 
加飞书、企业微信

 
了解类似的两个微信小程序
横向scroll-view

issue：子元素,"/>
    
    
    
    
    <meta property="og:site_name" content="小书斋"/>
    <meta property="og:type" content="object"/>
    <meta property="og:title" content="前端实习每周记 - 小书斋"/>
    <meta property="og:description" content="用来分享平日接触到的有意思的知识,1

第一周（2022&amp;#x2F;11&amp;#x2F;14 - 11&amp;#x2F;18）Monday
 
加飞书、企业微信

 
了解类似的两个微信小程序
横向scroll-view

issue：子元素,"/>
    
<link rel="stylesheet" href="/css/diaspora.css">

    <script>window.searchDbPath = "/search.xml";</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet">
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">小书斋</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://ikchen.top"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">前端实习每周记</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">前端实习每周记</h1>
        <div class="stuff">
            <span>十一月 14, 2022</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/%E5%91%A8%E8%AE%B0/" rel="tag">周记</a></li></ul>


        </div>
        <div class="content markdown">
            <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="第一周（2022-x2F-11-x2F-14-11-x2F-18）"><a href="#第一周（2022-x2F-11-x2F-14-11-x2F-18）" class="headerlink" title="第一周（2022&#x2F;11&#x2F;14 - 11&#x2F;18）"></a>第一周（2022&#x2F;11&#x2F;14 - 11&#x2F;18）</h4><h6 id="Monday"><a href="#Monday" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
加飞书、企业微信</p>
</li>
<li><p><input checked disabled type="checkbox"> 
了解类似的两个微信小程序</p>
<p><em>横向scroll-view</em></p>
<blockquote>
<p>issue：子元素宽度被压缩</p>
<p>solve：父元素设置overflow:auto，子元素设置flex-shrink:0  </p>
<br>

<p>issue：滚动条显隐show-scrollbar失效</p>
<p>solve：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">::webkit-scrollbar&#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">background-color</span>:transparent;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>

<br>

<p>issue：分页滑动paging-enabled失效</p>
<p>solve：用swiper组件替换scroll-view组件</p>
</blockquote>
</li>
<li><p><input checked disabled type="checkbox"> 
了解公司各部门业务：销售、运营、BPIT等，认识直系、旁系领导，产品概讲</p>
</li>
<li><p><input checked disabled type="checkbox"> 
与会，发懵</p>
</li>
</ul>
<h6 id="Tuesday"><a href="#Tuesday" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
页面上2&#x2F;3部分是可滑动卡片swiper，下1&#x2F;3部分为横向滑动scroll-view。</p>
<blockquote>
<p>情景：</p>
<p>当卡片切换时，scroll-view组件的子元素同样有卡片切换效果。且非最后四个子元素之前（一行展示四个子元素），表示选中的样式都添加到首个子元素上，scroll-view滑动。否则按次序往后切换选中样式。</p>
<p>点击scroll-view组件的某子项，显示对应可滑动卡片。</p>
<br>

<p>issue：暂令scroll-view一行显示5个子元素，当swiper卡片滑动到第6个子项及后，scroll-view没有发生滑动。</p>
<p>solve：</p>
<p>利用scroll-view组件的scroll-left属性，赋值：卡片的当前索引index*子项宽度。</p>
</blockquote>
</li>
<li><p><input checked disabled type="checkbox"> 
协助任务：做产品玩法的详解，——福袋、抽盒、一番赏等。接触各部分对接。</p>
</li>
</ul>
<h6 id="Wednesday"><a href="#Wednesday" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
对接中台部门，了解客户需求，做开发功能清单。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
协助中台，购置办公用品。</p>
</li>
</ul>
<h6 id="Thursday"><a href="#Thursday" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
对比同类型小程序，总结表格。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
采购。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
做头部活动、兴趣选择的组件。</p>
</li>
</ul>
<h6 id="Friday"><a href="#Friday" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><input checked disabled type="checkbox"> 联系小程序源码方。</li>
</ul>
<br>

<h4 id="第二周（11-x2F-21-11-x2F-25）"><a href="#第二周（11-x2F-21-11-x2F-25）" class="headerlink" title="第二周（11&#x2F;21 - 11&#x2F;25）"></a>第二周（11&#x2F;21 - 11&#x2F;25）</h4><h6 id="Monday-1"><a href="#Monday-1" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><input checked disabled type="checkbox"> 打杂。</li>
</ul>
<h6 id="Tuesday-1"><a href="#Tuesday-1" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><input checked disabled type="checkbox"> 摸鱼。</li>
</ul>
<h6 id="Wednesday-1"><a href="#Wednesday-1" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><input checked disabled type="checkbox"> 给我的任务是试一下服务器部署，了解微擎框架：可以用很多插件到微信小程序和公众号上去，比如说设置公众号的自动回复，或者发布一个转盘抽奖的插件到小程序上去，暂时了解是这样。</li>
</ul>
<h6 id="Thursday-1"><a href="#Thursday-1" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><input checked disabled type="checkbox"> 宝塔配置服务器，创建站点，同实习生帮我解决的。之前搭个人博客的域名，在这用上作用了，我给域名解析添加了条记录，后面申请SSL证书也需要添加记录。</li>
</ul>
<h6 id="Friday-1"><a href="#Friday-1" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
通过宝塔去下载微擎，有两个问题：</p>
<ol>
<li><p>需要SSL证书。</p>
</li>
<li><p>连接了shadowsockesX，但访问域名报错“500 Internal Privoxy Error”。如果不连接，下载微擎前的资质验证就会显示：无法访问外网。</p>
</li>
</ol>
</li>
<li><p><input checked disabled type="checkbox"> 
现在公司的服务器炸了，没能继续做。——更新：有云服务器了，下午准备的Linux虚拟机没用上，浅看了下，之前宝塔建站的问题是因为服务器，它推荐是在Linux环境下，当时在windows，所以再去做就会很快。后续微擎的安装还不知道。</p>
</li>
</ul>
<h6 id="总结："><a href="#总结：" class="headerlink" title="总结："></a><em>总结：</em></h6><p>这一部分的任务需要Linux基础，如果有了解，可能宝塔搭建站点时就不会稀里糊涂了。总的来说，的确是没接触过服务器部署这方面，每天焦头烂额但又没什么进展，甚至微擎都还没安装好。</p>
<p>打算周六周日把Linux学一下（非前端需要）。</p>
<p>更新：不需要Linux基础，当时需要的是Linux环境。</p>
<br>

<h4 id="第三周（11-x2F-28-12-x2F-2）"><a href="#第三周（11-x2F-28-12-x2F-2）" class="headerlink" title="第三周（11&#x2F;28 - 12&#x2F;2）"></a>第三周（11&#x2F;28 - 12&#x2F;2）</h4><h6 id="Monday-Wednesday"><a href="#Monday-Wednesday" class="headerlink" title="Monday - Wednesday"></a><em>Monday</em> - <em>Wednesday</em></h6><ul>
<li><input checked disabled type="checkbox"> 居家隔离，总算把微擎安装好了，但是现在又需要已备案的域名。</li>
</ul>
<h6 id="Thursday-2"><a href="#Thursday-2" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><input checked disabled type="checkbox"> 了解：PC端的购物网站是通过Shopify这个平台，通过模块化添加的方式，它也会提供主题模板，快速搭建起来的。Shopify平台写的页面用的是liquid语法。</li>
</ul>
<h6 id="Friday-2"><a href="#Friday-2" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
买了一个已备案的域名，下午在云服务器上准备按照之前的流程安装微擎，结果宝塔又报错了。——可能是PHP版本过高导致的站点404 page not found，接着是nginx报错创建不了站点，最后不管是PHP还是nginx都没法更新、卸载了。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
先在Linux虚拟机上试试，这些问题要交给上周说的那个小伙伴了。</p>
</li>
</ul>
<br>

<h4 id="第四周（12-x2F-5-12-x2F-9）"><a href="#第四周（12-x2F-5-12-x2F-9）" class="headerlink" title="第四周（12&#x2F;5 - 12&#x2F;9）"></a>第四周（12&#x2F;5 - 12&#x2F;9）</h4><h6 id="Monday-2"><a href="#Monday-2" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><input checked disabled type="checkbox"> 把阿里云域名的DNS服务器指向腾讯云，微擎正式能用了。</li>
</ul>
<h6 id="Tuesday-2"><a href="#Tuesday-2" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><input checked disabled type="checkbox"> 假的，微擎又不能访问了。解决了服务器解析和SSL证书问题。</li>
</ul>
<h6 id="Wednesday-2"><a href="#Wednesday-2" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
重新安装微擎，这会儿是真的可以了，然后在研究它的功能。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
创建微信公众号，但是微信公众平台上主体是个人，不能微信验证，有些接口权限比如：自定义菜单、群发、支付等等很多都没有。</p>
<p>虽然还只是简单实现了自动回复，但感觉很惊奇！</p>
</li>
<li><p><input checked disabled type="checkbox"> 
主要还是得了解微信小程序这边在微擎封装了的用法，支持自己开发插件。后面可能是要在公众号的底部菜单放一个跳转到小程序的链接。</p>
</li>
</ul>
<h6 id="Thursday-3"><a href="#Thursday-3" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><input checked disabled type="checkbox"> 试用了一个微擎市场的微信小程序插件。</li>
<li><input checked disabled type="checkbox"> 用微信公众平台原生实现了公众号菜单，菜单项和小程序关联起来了。小程序审核过，大概就没问题了。</li>
</ul>
<h6 id="Friday-3"><a href="#Friday-3" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><input checked disabled type="checkbox"> 做了个内部用的小组件：表单展示、跳转页面修改。</li>
</ul>
<br>

<h4 id="第五周（12-x2F-12-12-x2F-16）"><a href="#第五周（12-x2F-12-12-x2F-16）" class="headerlink" title="第五周（12&#x2F;12 - 12&#x2F;16）"></a>第五周（12&#x2F;12 - 12&#x2F;16）</h4><h6 id="Monday-3"><a href="#Monday-3" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
具体完善了一些组件的功能和样式：增删行的信息、登录注册，明天去看看路由拦截这一方面，比如说未登录状态想要跳转到名单内路径时，直接跳回登录注册页面。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
公司不用GitHub的原因是Github为公网，出于隐私就自己搭建了Git环境。</p>
</li>
</ul>
<h6 id="Tuesday-3"><a href="#Tuesday-3" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
做一个抽奖的页面，在想要怎么去实现中奖后那个礼盒抖动开盒、奖品展现的效果。——用popup弹出层组件，弹出一个GIF播放作开盒的效果。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
表单验证：未输入账号和密码不允许登录、输入长度限制等，用Vuex存一个变量值（Boolean）作index页提交按钮的disabled属性值，登录后在登录页将该变量赋值true（根据mobile和password都已输入，计算属性computed返回），index页按钮显示可提交，同时页面导航回index页。</p>
</li>
</ul>
<h6 id="Wednesday-3"><a href="#Wednesday-3" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
用Vue2的语法去写uniapp，在data中声明了两个Boolean类型变量，但是在methods中定义的点击事件无法修改它们。解决办法：定义两个computed分别引用这两个变量，再用完整写法都添加一个set、一个get。set将传入值赋给变量，get返回变量。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
表单验证：账号方面做了手机号码的正则校验。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
数据回显问题：</p>
<blockquote>
<p>scene：</p>
<p>在my-table表格组件中，点击某一行则将该行数据对象存入Vuex，然后跳转到详情页（分页），详情页将其获得并渲染。当修改某一条数据不想提交而返回上页，再次进入详情页的数据不应该是修改过的。</p>
<br>

<p>solve：</p>
<p>就是把传入Vuex中的某行数据对象，通过深拷贝独立于原本的数据对象。</p>
<p>浅拷贝和直接将数据对象传入Vuex，这样做在详情页获取并修改时，将原本的数据对象也更改了，那么下次再次点击表格某行进入详情页，依旧是上次的数据。</p>
</blockquote>
</li>
<li><p><input disabled type="checkbox"> 
页面中用computed缓存了一个Vuex数据对象，绑定在一个表单上。其中每个input或select都通过v-model与该数据对象某属性形成双向绑定，但问题在于Vuex中的state数据只能通过mutations方法去修改，input或select可以读，但写就会出现问题。</p>
<blockquote>
<p>另外定义计算属性变量，set调用Vuex的mutations方法去修改该对象某属性的数据，get返回数据。这种方法也行，但是太繁琐了，好多computed和mutation的定义。</p>
<br>

<p>好奇怪，我在Vuex的state存了个变量，试验不通过mutations的方法直接去修改，果然报错了。但是！！奇怪的是直接用v-model绑定数据字段，居然是可行、不报错的。</p>
</blockquote>
</li>
</ul>
<h6 id="Thursday-4"><a href="#Thursday-4" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
搜索框、登录组件的v-if判断，以前做过所以直接复用。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
用Vuex更新数据然后导航回页面时（登录后返回页面），会报一个错：</p>
<blockquote>
<p>Expected updated data but get first rendering data</p>
</blockquote>
<p>解决思路就是想怎么在数据更新后，让页面重新渲染。然后就用到了reLaunch这个方法，关闭所有页面，跳转到某个页面。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
给组件绑定click事件失效，加个修饰符native就行。另一种麻烦的方法是，在组件内部用emit触发给组件标签绑定的事件。</p>
</li>
</ul>
<h6 id="Friday-4"><a href="#Friday-4" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
调用getWindowInfo方法，得到设备的可用高度windowHeight，然后按占据的比例乘个几分之几，做各个区域view的高度。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
tab切换，展示不同的内容。小程序没有document语法了，要选中元素设置display:block和display:none比较麻烦，还是用Vue的v-if和v-show做切换。点击不同的tab，同时将data中变量scene改变：0、1、2，对应不同展示的内容。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
uni-drawer抽屉组件只能左右滑出，改了一下源码，从底部滑出。原本想用createAnimation方法将一个view以类似底部滑出的效果展现出来，但是这个view占据了一部分空间，导致页面可以整体上翻、下滑。</p>
</li>
</ul>
<br>

<h4 id="第六周（12-x2F-19-12-x2F-23）"><a href="#第六周（12-x2F-19-12-x2F-23）" class="headerlink" title="第六周（12&#x2F;19 - 12&#x2F;23）"></a>第六周（12&#x2F;19 - 12&#x2F;23）</h4><h6 id="Monday-4"><a href="#Monday-4" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
利用swiper原生内置组件，做中奖信息向上轮播的功能。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
100px.net上有转盘、老虎机等抽奖模块的用法，在uniapp上配置和实现。</p>
</li>
</ul>
<h6 id="Tuesday-4"><a href="#Tuesday-4" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
uniapp开发的微信小程序，它的代码是压缩的，比如说一些变量名缩减成一个字符、方法名变成数字，逻辑性降低了。可以通过反编译（b站有教程），把微信小程序（原生）的代码反编译为uniapp的语法。但是，uniapp开发的微信小程序不能再反编译回uniapp语法！</p>
</li>
<li><p><input checked disabled type="checkbox"> 
所以我现在在自己改代码，页面倒是能改回去，只是Js的逻辑代码和一些数据规范不是很好懂。而且这个微信小程序是很多模块的，模块和模块的交互，肯定不是我现在这样简单。总的来说，现在就是繁琐，没有操作性。</p>
</li>
</ul>
<h6 id="Wednesday-Friday"><a href="#Wednesday-Friday" class="headerlink" title="Wednesday - Friday"></a><em>Wednesday</em> - <em>Friday</em></h6><ul>
<li><input checked disabled type="checkbox"> 发烧居家。</li>
</ul>
<br>

<h4 id="第七周（12-x2F-26-12-x2F-30）"><a href="#第七周（12-x2F-26-12-x2F-30）" class="headerlink" title="第七周（12&#x2F;26 - 12&#x2F;30）"></a>第七周（12&#x2F;26 - 12&#x2F;30）</h4><h6 id="Monday-5"><a href="#Monday-5" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
把之前做的登录组件拿过来用，根据token有无显示不同的组件。抽奖模块和登录结合起来，用户登录后可以记录奖品。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
对于抽奖过程的popup组件播放gif，设置isMaskClick为false，禁止用户操作。gif背景透明且播放一次，用定时器setTimeout在2s后（gif播放时间）弹出中奖信息。</p>
</li>
</ul>
<h6 id="Tuesday-5"><a href="#Tuesday-5" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
开始从后端验证抽奖模块的功能，比如中奖的数字由后端计算返回，不放在前端（爬虫很容易拿到并篡改）。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
反编译了“盒柜”和“我的”页面一部分。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
向后端提两个接口的需要，一个修改，一个查看。字段product定义为数组，元素是对象。用户登录后可以拿到用户id，然后用这个id去向查看接口发请求，拿到这个用户的已有的商品列表。同样，拿id去向修改接口发请求，修改用户的商品数据（中奖时添加）。</p>
</li>
</ul>
<h6 id="Wednesday-4"><a href="#Wednesday-4" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
把小程序的页面全都反编译出来了，js的逻辑还没去写。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
抽奖模块要和登录联合起来，vuex中store的token从storage中读取，登录时也存到storage中去，也就是说登录一次，一段时间内不用重复登录。有点小问题是，同页面内，用mapState去读store中的token，登录页面（v-if）和已有商品列表（v-else）总是显示登录页面，就是说token没有正常读取。</p>
<p>它在登录后，页面还是能根据token来切换组件的，但在这之前，即使localStorage中有token的值也没有正常显示对应的组件。</p>
<blockquote>
<p>果然，mapState出来的token，在页面首次加载时打印为undefined，登录后则有值。</p>
<br>

<p>solve:</p>
<p>在页面的data中也添加一个token字段，值从storage中读取getStorageSync(‘token’)。</p>
<p>本来mapState的token就可以正常切换组件的（即使首次加载），我之前也是这个做法，当时是没有问题的。</p>
</blockquote>
</li>
</ul>
<h6 id="Thursday-5"><a href="#Thursday-5" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
vuex mutations中定义的方法，携带第一个参数为state，访问为undefined。原因是state定义的形式为箭头函数，改成括号形式就可以了。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
下载的一个添加收获地址的组件里，input双向绑定用的是:value，但子传父打印的数据里都是空串，显然没有双向绑定成功，改用v-model。</p>
<blockquote>
<p>:value是v-bind:value的简写方式，这是单向数据绑定。</p>
</blockquote>
</li>
<li><p><input checked disabled type="checkbox"> 
从页面A跳转到页面B，有一个参数需要在页面B用到，之前都是用vuex去设置。可以用另一种简单的方法，从页面A跳转到页面B时，在路径后携带参数，页面B中可以在生命周期onLoad(e)中接收到该参数。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
上一条的具体情景是：</p>
<blockquote>
<p>收货地址可以新增，也可以点击某一项进行修改。对后者，我们用到了路径携带过来的index参数，表示当前点击的收货地址数据的索引，进行数据渲染（点击不同项，显示不同的收货地址信息），当我们修改并确定保存，就将收获地址的数据字段userAddress中的第index项，修改为表单重新修改的对象。</p>
<br>

<p><em>issue:</em></p>
<p>问题就是直接修改数组对象，即使数据的确改变了，但页面不会渲染。</p>
<br>

<p><em>solve:</em></p>
<p>方法一：vuex是分模块做的，就在对应的js文件中引入Vue，调用方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vue.set(targetArray, index, obj)</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">set</span>(state.<span class="property">userAddress</span>, state.<span class="property">updateIndex</span>, userAddress)</span><br></pre></td></tr></table></figure>

<p>方法二：深拷贝</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">state.<span class="property">userAddress</span>[state.<span class="property">updateIndex</span>] = userAddress</span><br><span class="line">state.<span class="property">userAddress</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(state.<span class="property">userAddress</span>))</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<h6 id="Friday-5"><a href="#Friday-5" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
向后端写了个文档：需要收货地址的查询、设置接口；订单的创建（返回订单号）、预付订单（返回订单信息，用于微信支付requestPayment）、查询订单（参数：订单号，是否成功支付）的接口。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
微信公众平台可以申请几个接口的权限，比如获取用户收货地址chooseAddress、地图选择位置接口chooseLocation等，需要在manifest.json的源码中设置（uniapp）。否则是调用不成功的。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
chooseLocation唤起选择地址的界面（相当于嘀嘀打车快速定位）后，对地址数据处理，然后填充进收货地址的省区和详细地址input。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
这个收货地址的新增和修改是共用一个组件的，我在组件里定义了一个props，修改的话就会传一个数据对象给组件，然后把这个数据对象赋值给组件内部data的一个字段userAddress。</p>
<p>现在的情景是如果我是新增收货地址，那么上一条所做的chooseLocation选择地址、填充input，此时失效。我一直以为是HBuilderX的问题时好时坏，最后发现是传入的props数据字段的赋值没有做条件限制。如果没有传入props，就会把空对象赋给本地，后面就找不到对象底下的数据字段。</p>
<p>就是说，修改会传props给组件，新增不会。这里就要在组件里去判断对象（组件定义的那个prop）是否为空对象（default为{}），不是（表示有传入的数据）再做赋值给本地的操作。</p>
<p>回去复习了一下判断是否为空对象的两个方法：</p>
<blockquote>
<p><em>方法一：</em></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">item</span>) !== <span class="string">&#x27;&#123;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><em>方法二</em></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">item</span>).<span class="property">length</span> !== <span class="number">0</span></span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<br>

<h4 id="第八周（2023-x2F-1-x2F-3-1-x2F-6）"><a href="#第八周（2023-x2F-1-x2F-3-1-x2F-6）" class="headerlink" title="第八周（2023&#x2F;1&#x2F;3 - 1&#x2F;6）"></a>第八周（2023&#x2F;1&#x2F;3 - 1&#x2F;6）</h4><h6 id="Monday-6"><a href="#Monday-6" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><input checked disabled type="checkbox"> 休假。</li>
</ul>
<h6 id="Tuesday-6"><a href="#Tuesday-6" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
通过一个接口请求回来的数据列表，首先存到本地storage里，读取的速度快很多。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
token失效，页面登出</p>
<blockquote>
<p>通过登录接口拿到expire字段，存到vuex，然后在vuex存入token的方法的末尾加上一个定时器setTimeout（只执行一次），清除token（vuex和storage），时间为之前存入的expire字段。</p>
<p>让后端暂时把expire改成15000（15s），情况是token数据是清除掉了，但是页面没有刷新为登出状态。重新编译才有效果。</p>
<p>vuex数据刷新了，但组件本地的数据没有更新。</p>
<p>之前遇到这种不能刷新的问题，用relaunch（关闭所有页面，进入某页面）或者redirectTo（重定向）就相当于刷新了页面（数据就和vuex保持一致了），但是现在当前页不能跳转到当前页。本来的想法是在当前页同样开启一个一次性定时器setTimeout，时间为通过mapState传递过来的expire过期时间，重新跳转到当前页。</p>
<br>

<p>嘿！又可以重定向到当前页了！！</p>
<p>真的好离谱，我试验了下：在定时器里写的重定向就是不可行，非得要我在定时器函数外写的uni.redirectTo，复制进定时器函数内才有效果！这是HbuilderX的问题吧！！</p>
<p>又试验了下：在定时器里写的，有时有用有时失效。</p>
</blockquote>
</li>
<li><p><input checked disabled type="checkbox"> 
上周有一个问题是mapState出来的数据初次渲染无效，不得不在本地data中读取了storage的数据（同数据）。现在报错了，把data数据去掉报错消失。（大概两小时后）又要给data数据加上才行…</p>
<p>不用mapState了，直接在本地data中用getStorage()读取vuex存储到本地的数据。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
在vuex的address模块中，getters返回一个选择为默认的地址，通过filter方法（它是返回符合条件的元素）。</p>
</li>
</ul>
<p>总结：之前用vscode写后台管理，报错了，一定是我的语法问题。现在用HBuilderX写uniapp，我真的总会怀疑是软件的问题，某些程序时可行、时不可行！某些逻辑可通的（我确信）理论，居然不被支持！</p>
<p>或者是uniapp的语法问题，我刷了几篇论坛，似乎是它的坑比较多。</p>
<h6 id="Wednesday-5"><a href="#Wednesday-5" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
简单做出了一个抽奖联合登录、发货、订单（暂无）、商品详情的模块，只是功能，完全没有UI。ld让前后端写个文档具体描述：到完整上线要多少人天。不包括测试，前端的优化、设计和编写暂时是10天&#x2F;人。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
之前反编译出来的uniapp程序，其中的组件可以复用出来。优化已中奖商品列表，样式问题：</p>
<blockquote>
<p>一个顶部导航条（组件）的切换，底下是另一个区域。这个区域用margin-top和导航条隔离开，但总是导致margin-top的值变成导航条的高度，两个区域紧连接在一起.</p>
<br>

<p>用绝对定位absolute解决，不再占有原来空间。（相对定位relative原有空间还是存在的，所以不起效）。</p>
</blockquote>
</li>
<li><p><input checked disabled type="checkbox"> 
优化收货地址列表及详情页的样式。黑白灰搭配一丢丢许嵩妹妹说很有韵味的淡紫，好看的嘞！</p>
</li>
<li><p><input checked disabled type="checkbox"> 
收货地址的两种情况（修改和添加），对于修改，switch组件设为默认（true）的同时用forEach在vuex里把所有的地址的isDefault设为false，之前没有考虑到添加，导致添加设置的默认在收货地址列表上会和已有默认造成重复。提交时再执行一遍vuex中forEach的那个方法就行。</p>
<p>另外，这时不填写任何地址信息也是可以提交的，地址列表就会显示一个空白的子项，应该禁止：条件判断对象每项元素boolean值，短路或||连接，进入判断return一条showToast。</p>
<p>删除也好做，根据列表的index值，删除（splice）vuex中state的地址信息数组对应索引的对象元素。</p>
</li>
</ul>
<h6 id="Thursday-6"><a href="#Thursday-6" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
反编译JS第一步，读懂data里参数的含义。抽奖页面的逻辑展示是通过不同参数的v-if和v-else来判断，有一块支付区域的展示比较复杂，用到了三层if、else对，又要考虑特殊情况（就是用到额外的参数做条件），理清楚关系和做参数文档（格式、作用注释）——14个参数param，90行，花了我两三小时。因为到时后端要去做这些参数，肯定要考虑到前端是怎么做呈现的，参数的逻辑他来做就要我说清楚。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
参数里有个变量是$root会报一个toJSON未定义但在渲染时使用的错，改成root。然后简单完善了这个抽奖页面的点击商品弹出详情popup、弹出支付popup、页面跳转的方法。</p>
</li>
</ul>
<h6 id="Friday-6"><a href="#Friday-6" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
根据参数显示界面，完善方法methods——耐心还是能看懂的。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
做参数字段文档。</p>
</li>
</ul>
<br>

<h4 id="第九周（1-x2F-9-1-x2F-13）"><a href="#第九周（1-x2F-9-1-x2F-13）" class="headerlink" title="第九周（1&#x2F;9 - 1&#x2F;13）"></a>第九周（1&#x2F;9 - 1&#x2F;13）</h4><h6 id="Monday-7"><a href="#Monday-7" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
上周用一个轮播图组件的同时，底下有一块卡片区域，用于显示对应轮播图奖品的概率、品牌、价格。卡片左右分别是前进、后退按钮，可以切换轮播的奖品图。</p>
<blockquote>
<p>轮播图组件图片切换时，会更新组件的当前索引current字段，点击切换我们只要对这个字段进行加、减、小于0则赋值为图片个数减1（末尾同理）。</p>
<p>当然要做节流处理，不然一个图片正在轮播时又点击切换，就会有切换效果的异常。</p>
<p>思想就是设置一个标识moving，初始false。在点击切换（methods）时首先判断如果为true，return出去、不进入函数，然后再把moving设置为true。最后要在程序处理完后把标识重新设置为false，表示轮播结束，可再次切换。</p>
<p>uniapp的原生组件swiper中有个动画结束方法animationfinish，此时把标识moving设置为false，符合思想并且实现了效果。之所以不在点击切换的method末尾设置为false，是这时即便设置了，图片轮播时标识已经为false（执行完切换的method再去轮播）。</p>
</blockquote>
</li>
</ul>
<h6 id="Tuesday-7"><a href="#Tuesday-7" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><input checked disabled type="checkbox"> 写页面，没有设计稿。</li>
</ul>
<h6 id="Wednesday-6"><a href="#Wednesday-6" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
写uniapp还是要用响应式rpx（2rpx等于1px）为单位去适配不同的机型。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
有一块区域设置了高度690rpx，A机型能全部显示出来，B机型最大显示高度650rpx。因此造成的布局样式错乱，把高度改成650rpx（兼容最小标准）。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
有时改一个样式，其他很多地方也要跟着一起改。用less预编译定义样式变量，要有这个习惯，之前真的好麻烦。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
写页面不会有太难的地方，就一点点耗时间。但就是昨天说的没有设计稿，大部分时间要用在设计上，要从产品的理念和客户视角出发。——其实就是借鉴其他的APP。</p>
</li>
</ul>
<h6 id="Thursday-7"><a href="#Thursday-7" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
不要给block标签添加样式，block不会渲染在结构上，如果用less的语法在block的class基础上往下写，不会有效。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
uniapp的drawer组件只能左右滑，上次修改了下可以底部滑出，但宽高只能指定。</p>
<blockquote>
<p>目的是：更换机型后都能做到drawer的宽度100%横屏、高度1&#x2F;2全屏。</p>
<p>情况：用getWindowInfo获取设备的宽高后，用数据绑定将这个宽或高的字段（本地data默认为0），通过prop传入drawer组件，但在组件内这个值总为0。非动态绑定的数据字段比如一个数字，组件能正常获取。</p>
<br>

<p>也就是说动态绑定时，组件内部获取的是prop传入数据字段的默认值0，修改默认值查验得知。但在组件外的mounted钩子中，本地字段的宽高数据赋值，通过验证是没有问题的。</p>
<p>可能：prop传入组件的时间在页面mounted钩子之前。</p>
<p>结果：官方文档说width字段不支持动态绑定。</p>
<br>

<p>页面mounted的逻辑放在计算属性computed里进行，return一个宽度，这样通过动态绑定给组件内部传值时，就相当于传入一个静态的值。</p>
</blockquote>
</li>
</ul>
<h6 id="Friday-7"><a href="#Friday-7" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
封装组件时（写页面同理），样式不写在组件的style内，而是单独写一个css文件，再在组件内引入。直到刚才要写一个重复的样式，我就明白这样的好处了。（看的github项目）</p>
</li>
<li><p><input checked disabled type="checkbox"> 
好玩的reduce：</p>
<blockquote>
<p>购物车的结算金额是根据商品的勾选状态checked来计算的，首先筛选出勾选状态为true的商品数组，然后映射出其中每个对象的价格price，即此时数组的每个元素是符合条件的价格price。</p>
<p>reduce方法：</p>
<p>第一个参数为回调函数，——它的头两个参数为总数值（或前一次回调函数返回的数值）prev，和遍历数组的当前值current。</p>
<p>第二个参数为回调函数中prev的初始值，默认0。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">cartList</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">checked</span>)</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">price</span>)</span><br><span class="line">    .<span class="title function_">reduce</span>(<span class="function">(<span class="params">prev, current</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> prev + current</span><br><span class="line">    &#125;,<span class="number">0</span>)</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<h4 id="第十周（1-x2F-16-1-x2F-20）"><a href="#第十周（1-x2F-16-1-x2F-20）" class="headerlink" title="第十周（1&#x2F;16 - 1&#x2F;20）"></a>第十周（1&#x2F;16 - 1&#x2F;20）</h4><h6 id="Monday-8"><a href="#Monday-8" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
写页面：&lt;商品详情&gt;、&lt;款式选择drawer&gt;、&lt;支付详情&gt;、&lt;支付方式drawer：支付宝和微信&gt;、&lt;购物车&gt;。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
封装组件，比如购物车的商品卡片也可在商品详情页、支付详情页使用，通过props传入的条件做不同的展示。</p>
</li>
</ul>
<h6 id="Tuesday-8"><a href="#Tuesday-8" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><input checked disabled type="checkbox"> 写页面：&lt;个人中心&gt;。收货地址和登录注册写过，复用就行，但是登录注册模块的样式要优化。</li>
</ul>
<h6 id="Wednesday-7"><a href="#Wednesday-7" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
支付详情页会展示选择的地址，在store的address模块中，用getter返回已设置默认（isDefault:true）的那项对象，渲染就行。根据这个选择的地址对象的长度展示，有时true展示地址详情，无时false展示请添加地址。</p>
<blockquote>
<p>有个样式小问题是：</p>
<p>本意是通过动态绑定class，条件判断为上面说的选择对象length。可以有瑕疵的实现，即&lt;有时地址详情&gt;会继承&lt;无时请添加地址&gt;的样式，重新编译后才恢复正常。</p>
<p>最终给&lt;请添加地址&gt;本身标签添加了class，margin:0 auto水平居中。</p>
</blockquote>
</li>
<li><p><input checked disabled type="checkbox"> 
uni-swipe-action的滑动删除一项时，其余项都会自动关闭，autoClose默认为true。莫名奇妙不能自动关闭，搞了好一会，看起来没问题且不明所以的bug吧。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
称&lt;商品详情页&gt;为<strong>A</strong>。<strong>A</strong>其中展示品牌、价格等信息的区域通过组件<card-description>的props条件渲染出来，该组件称为<strong>B</strong>，&lt;购物车页&gt;称为<strong>C</strong>。</card-description></p>
<blockquote>
<p><em>思路</em>：</p>
<p>当在商城点击一个商品时，跳转到<strong>A</strong>并携带上商品ID，这个ID再传递给子组件<strong>B</strong>作请求数据的参数，此后<strong>B</strong>把请求回来的数据（brand、price、inventory等）通过子传父emit传递回<strong>A</strong>，在<strong>A</strong>中的&lt;加入购物车&gt;按钮中就可以通过Vuex将这个数据对象push进入<strong>C</strong>需要渲染的商品字段。</p>
<p><em>解释</em>：</p>
<p>可以不用封装<strong>B</strong>组件，直接写在<strong>A</strong>中，这个流程就可以简化。</p>
</blockquote>
</li>
</ul>
<h6 id="Thursday-8"><a href="#Thursday-8" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
在看Github小程序项目，之前提过一次的token失效、页面登出，不是我那个做法。而是：用axios创建的实例的请求拦截器中，请求头的Authorization字段设置为存储到本地的token，即每次请求前都会首先在后端校验token，token失效返回错误promise，未失效正常返回数据。</p>
<blockquote>
<p>后端的失效处理可能和前端的一种处理方式类似：前端在首次获得token时会打一个当前初始的时间戳，此后每次请求都会用此刻的时间戳，减去初始时间戳，两者之差和过期事件expires比较。</p>
</blockquote>
</li>
</ul>
<h4 id="第十一周（1-x2F-30-2-x2F-3）"><a href="#第十一周（1-x2F-30-2-x2F-3）" class="headerlink" title="第十一周（1&#x2F;30 - 2&#x2F;3）"></a>第十一周（1&#x2F;30 - 2&#x2F;3）</h4><h6 id="Monday-9"><a href="#Monday-9" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
购物车的商品每一个都勾选时，总的全选按钮也同时勾选。</p>
<blockquote>
<p> 方法一：</p>
<p>返回&lt;购物车商品总个数&gt;和&lt;购物车商品checked为true的个数&gt;两者全等的布尔值。</p>
<p>方法二：</p>
<p>数组every()方法，元素全返回true时，整体返回true。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> state.<span class="property">cartGoods</span>.<span class="title function_">every</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">checked</span>)</span><br></pre></td></tr></table></figure>

<p>   但把购物车清空时，全选radio还是为勾选。因为此时cartGoods是个空数组，every()对空数组检测直接返回true。另外加个判断，cartGoods长度为0时直接返回false。</p>
</blockquote>
</li>
</ul>
<h6 id="Tuesday-9"><a href="#Tuesday-9" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><input checked disabled type="checkbox"> 看了下微信开发文档的&lt;云托管&gt;和&lt;云开发&gt;，尝试了解怎么做微信支付。</li>
<li><input checked disabled type="checkbox"> 写页面。</li>
</ul>
<h6 id="Wednesday-8"><a href="#Wednesday-8" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
了解了下uniapp文档里的云开发uniCloud，有手机号一键登录（APP）、发送短信等模块。之前创建小程序时一直默认uniapp框架，其实还有uni-starter和uni-admin框架，前者uni-starter提供了已经封装好比如登录注册、修改密码、路由拦截等功能，后者uni-admin则是提供了用户管理、权限管理等模块的管理端。</p>
<p>两者可以分别创建，接入到uniCloud的同一个云空间，达到联合效果，比如滴滴打车的用户端和司机端，或者是电商小程序的用户端和商家端（To C, To B）。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
原本微信支付只要通过requestPayment向服务器的接口发请求就可以的，但现在没有接口，尝试用uniCloud下的uniPay，相当于封装好的后端服务，开箱即用。</p>
</li>
</ul>
<h6 id="Thursday-9"><a href="#Thursday-9" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
小红书首页是瀑布流布局，也是从Pinterest借鉴来的，B站Up&lt;CodingStartup起码课&gt;讲了两种实现方式。</p>
<p>uCloud插件市场有瀑布流插件<waterfall>，其中一个js文件用promise返回假数据，使用组件的地方通过该文件export的方法获得数据，虽然也是mock data但模拟了请求。接着就可以做触底加载的逻辑。</waterfall></p>
</li>
</ul>
<h6 id="Friday-8"><a href="#Friday-8" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><input checked disabled type="checkbox"> 修改了两种登录方式的页面，一是手机号密码登录，二是验证码登录，后者要服务器开通一个短信服务。</li>
</ul>
<h4 id="第十二周（2-x2F-6-2-x2F-10）"><a href="#第十二周（2-x2F-6-2-x2F-10）" class="headerlink" title="第十二周（2&#x2F;6 - 2&#x2F;10）"></a>第十二周（2&#x2F;6 - 2&#x2F;10）</h4><h6 id="Monday-10"><a href="#Monday-10" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
页面跳转navigateTo也可携带对象参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 携带时</span></span><br><span class="line"><span class="string">&quot;路径?paynow=&quot;</span>+<span class="built_in">encodeURIComponent</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">childData</span>))</span><br><span class="line"><span class="comment">// 接收时（parse不能转换undefined，先判断是否为undefined）</span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="built_in">decodeURIComponent</span>(options.<span class="property">paynow</span>))  </span><br></pre></td></tr></table></figure>

<p>encodeURIComponent编码，decodeURIComponent解码。</p>
<p>不编码也能传递接收（就携带一个参数），之所以编码：</p>
<ol>
<li>参数<code>username=&quot;hello&amp;world=1&quot;</code>，不编码参数可能会被识别为：<code>username=hello&amp;world=1</code>，一个参数变两个。</li>
<li>把字符比如空格、中文转成浏览器能识别的。</li>
<li>数据隐私和size过大。</li>
</ol>
</li>
<li><p><input checked disabled type="checkbox"> 
&lt;结算页面&gt;的商品列表有两种情况：</p>
<ol>
<li><p>&lt;购物车&gt;已勾选的商品</p>
</li>
<li><p>&lt;商品详情页&gt;立即购买、当前商品</p>
<p>加个条件，如果是通过&lt;商品详情&gt;立即购买进入的&lt;结算页面&gt;，就用当前商品渲染。</p>
<p>否则会出现：立即购买时如果购物车中已勾选，就会直接渲染购物车的数据。</p>
</li>
</ol>
</li>
<li><p><input checked disabled type="checkbox"> 
和产品对接了一下第一阶段小程序要出的功能模块，他的原型图还在画。</p>
</li>
</ul>
<h6 id="Tuesday-10"><a href="#Tuesday-10" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
根据功能清单做前端的修改。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
搜索框下的历史记录，点删除图标就把记录全部删除。</p>
<ul>
<li><p>简单的就是将渲染记录的数组等于[ ]，但新建数组[ ]浪费了原本数组占有的空间（产生垃圾）。</p>
</li>
<li><p>将数组的长度置0也能清空，只是此时的全部删除效果要重新编译才可见。重新编译之前：存在本地的数组已清空，但AppData里还保留着数据。（不明白）</p>
</li>
<li><p>&#96;&#96;&#96;javascript<br>splice(0, this.historyList.length)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###### *Wednesday*</span><br><span class="line"></span><br><span class="line">- [x] 以为&lt;回到顶部&gt;要自己写，原来小程序有`pageScrollTo()`这个方法可以调用。</span><br><span class="line"></span><br><span class="line">- [x] 自定义导航栏</span><br><span class="line"></span><br><span class="line">  ![image-20230208173126916](C:\Users\16236\AppData\Roaming\Typora\typora-user-images\image-20230208173126916.png)</span><br><span class="line"></span><br><span class="line">  &gt; &lt;uni-nav-bar&gt;组件支持我们自定义导航栏，比如左侧的&lt;返回&gt;和&lt;回首页&gt;图标，右侧是小程序自带去不掉的胶囊。</span><br><span class="line">  &gt;</span><br><span class="line">  &gt; 组件提供了左、中、右三个插槽，可以填入任意内容：比如Logo、搜索input。</span><br><span class="line">  &gt;</span><br><span class="line">  &gt; 如图是两个区域（上下）：&lt;手机自带的状态栏&gt;，和&lt;小程序导航栏&gt;。</span><br><span class="line">  &gt;</span><br><span class="line">  &gt; 目的是让左侧自制的胶囊和小程序自带的胶囊做到匀称，有一个不同机型的适配：</span><br><span class="line">  &gt;</span><br><span class="line">  &gt; ```javascript</span><br><span class="line">  &gt; // 获得手机状态栏的高度</span><br><span class="line">  &gt; const that = this</span><br><span class="line">  &gt; uni.getSystemInfo(&#123;</span><br><span class="line">  &gt;     success(res) &#123;</span><br><span class="line">  &gt;         that.statusBarHeight = res.statusBarHeight</span><br><span class="line">  &gt;     &#125;</span><br><span class="line">  &gt; &#125;)</span><br><span class="line">  &gt; </span><br><span class="line">  &gt; // 获取右侧原生胶囊的位置信息：相对于屏幕左上角</span><br><span class="line">  &gt; const &#123; width, height, top, right &#125; = wx.getMenuButtonBoundingClientRect()</span><br><span class="line">  &gt; const aboveHalf = top - this.statusBarHeight	// 小程序导航栏中，胶囊上半部分的高度</span><br><span class="line">  &gt; // 设置自定义导航的高度</span><br><span class="line">  &gt; this.myBarHeight = height + 2*aboveHalf</span><br><span class="line">  &gt; </span><br><span class="line">  &gt; // 设置左侧自制的胶囊的上、左margin：保持和右侧胶囊的对称</span><br><span class="line">  &gt; this.capsuleTop = aboveHalf</span><br><span class="line">  &gt; this.capsuleLeft = uni.getWindowInfo().screenWidth - right</span><br></pre></td></tr></table></figure>
<blockquote>
<p><uni-nav-bar>把statusBar设为true，就是包含&lt;手机状态栏&gt;的高度，不用计算了。</uni-nav-bar></p>
<p>接着动态绑定，在标签里分别设置<uni-nav-bar>的高度myBarHeight、自制胶囊的margin-left、margin-top。</uni-nav-bar></p>
</blockquote>
</li>
</ul>
</li>
<li><p><input checked disabled type="checkbox"> 
解决了<uni-nav-bar>设置fixed不能固定置顶的bug，修改源码对应的fixed样式。</uni-nav-bar></p>
</li>
<li><p><input checked disabled type="checkbox"> 
原来<uni-nav-bar>左侧插槽原本就能和右侧胶囊对称，哎！</uni-nav-bar></p>
</li>
</ul>
<h6 id="Thursday-10"><a href="#Thursday-10" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
申请微信公众号（服务号）和认证企业主体，之后认证资质可以快速复用到小程序上，都已认证好了。接着微信商户号也可以继续申请（微信支付需要）。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
企业的小程序账号可以接入物流（查看物流信息）等，要我们自己的开发者服务器（后端）部署，前端再去拿后端获取的数据。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
客服</p>
<blockquote>
<p>页面用button组件，直接跳到原生的微信对话框。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">open-type</span>=<span class="string">&quot;contact&quot;</span> @<span class="attr">contact</span>=<span class="string">&quot;getMessage&quot;</span>&gt;</span>联系客服<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后在对应的小程序账号appid的微信公众平台添加客服人员，有小程序和PC端可以处理用户消息。</p>
</blockquote>
</li>
</ul>
<h6 id="Friday-9"><a href="#Friday-9" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><input checked disabled type="checkbox"> 微信小程序没法直接唤起支付宝。</li>
</ul>
<p>开会，主持人投屏，大家都聚焦着。</p>
<p>右下角弹出了Steam（游戏平台）好友游戏的消息——</p>
<h4 id="第十三周（2-x2F-13-2-x2F-17）"><a href="#第十三周（2-x2F-13-2-x2F-17）" class="headerlink" title="第十三周（2&#x2F;13 - 2&#x2F;17）"></a>第十三周（2&#x2F;13 - 2&#x2F;17）</h4><h6 id="Monday-11"><a href="#Monday-11" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><input checked disabled type="checkbox"> 小程序第一版前端过了评审。</li>
</ul>
<h6 id="Tuesday-11"><a href="#Tuesday-11" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
罗列商城用户交互路径、页面资源引用、后端所需接口的树结构。</p>
</li>
<li><p><input checked disabled type="checkbox"> </p>
<ol>
<li>前端获取手机号的API，getPhoneNumber获取动态令牌code，把这个code传给后端（后端也是调一个官方接口，不允许小程序前端调用），后端携带参数code和access_token获取手机号，返回前端。</li>
<li>登录也是，前端获取code，后端携带code、appid等参数请求官方接口，请求到&lt;自定义登录态&gt;等，并返回前端。之后前端的每次业务请求携带&lt;自定义登录态&gt;，后端通过校验才返回数据。</li>
</ol>
</li>
</ul>
<h6 id="Wednesday-9"><a href="#Wednesday-9" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><input checked disabled type="checkbox"> 解决shopify网站的排版问题。</li>
<li><input checked disabled type="checkbox"> 拆分任务，明天有前端的新同学来。</li>
</ul>
<h6 id="Thursday-11"><a href="#Thursday-11" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
Vuex中的state用parse接收storage中的数据，parse不能对空操作，提前判断一下。</p>
<blockquote>
<p>原本在JSON.parse中，可以用<code>||</code>承接本地数据（前）和默认值（后），但偶尔会报错，得出的结论就是parse操作的数据非JSON格式。</p>
</blockquote>
</li>
<li><p><input checked disabled type="checkbox"> 
getUserInfo和getUserProfile都不能获取用户昵称和头像了。</p>
<blockquote>
<p>首先头像和昵称都给个默认值，接着点击该区域跳转到另一个页面，用&lt;头像昵称填写&gt;，修改头像昵称。</p>
<p>需要注意的是，无论是使用微信头像还是自选、照相，都只是临时地址。</p>
<p>我把它存到本地，存入成功，则&lt;个人中心&gt;的头像渲染为修改后（这里没考虑临时地址的失效，目前功能正常。可能要下载图片）。</p>
<p>存入不成功的情况（或未存）就是：用户进入修改页面但没有操作，给该页面头像和昵称分贝指定渲染的data为临时temp变量，对应temp有值时再调用mutations方法。解决用户未操作但返回上级页面时清空数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">tempAvatar</span> ? <span class="variable language_">this</span>.<span class="title function_">setAvatar</span>(<span class="variable language_">this</span>.<span class="property">tempAvatar</span>) : <span class="number">0</span></span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<h6 id="Friday-10"><a href="#Friday-10" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
一键登录</p>
<p>微信原生的登录login是没有授权弹框的，借助getphonenumber的授权弹框获取手机号（作账号），同时调用login获取openid（作密码），用于向开发服务器请求登录（注册）。（是这么想的，没确定）</p>
</li>
</ul>
<h4 id="第十四周（2-x2F-20-2-x2F-24）"><a href="#第十四周（2-x2F-20-2-x2F-24）" class="headerlink" title="第十四周（2&#x2F;20 - 2&#x2F;24）"></a>第十四周（2&#x2F;20 - 2&#x2F;24）</h4><h6 id="Monday-12"><a href="#Monday-12" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><input checked disabled type="checkbox"> 购物车的增、删、改、查接口（部分。数据以后端为准，避免实际数据和展示数据不一样）。</li>
<li><input checked disabled type="checkbox"> 个人信息（头像昵称）的查改接口。</li>
</ul>
<h6 id="Tuesday-12"><a href="#Tuesday-12" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
似乎数据库被攻击，导致后端接口调用失败。</p>
<p>封装收货地址的CRUD接口、搜索框的热搜记录接口、分类接口。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
之前是用mixins在相应页面中调用接口，重新整合了一下，分模块封装在utils&#x2F;api目录下。</p>
</li>
</ul>
<h6 id="Wednesday-10"><a href="#Wednesday-10" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><input checked disabled type="checkbox"> 在PC后端管理端配置了一下热搜数据、分类数据，小程序能正常请求到了。</li>
<li><input checked disabled type="checkbox"> 接口来源商家端、平台端、小程序端，现在我主要调的是小程序端的api，但有时也要去用到其他两端的api，比如上一点的数据配置和得到我希望用到的字段。复杂的地方还是在于数据的层级和映射关系，和后端沟通了一下就明白了。</li>
</ul>
<h6 id="Thursday-12"><a href="#Thursday-12" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><input checked disabled type="checkbox"> 购物车要考虑多店铺、多sku，也就说一个店铺有多个商品，同时有多店铺的情况，现在是默认店铺唯一（初版由自身商铺上货），基本上没问题了。</li>
</ul>
<h6 id="Friday-11"><a href="#Friday-11" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><input checked disabled type="checkbox"> 之前说的token过期登录失效，就是前端每次请求都会携带token给后端校验，校验不通过返回一个表示未授权的状态码，前端判断这个状态码，清除本地token，弹出重新登录提示框。</li>
<li><input checked disabled type="checkbox"> 收货地址接口。</li>
<li><input checked disabled type="checkbox"> 用jQuery写了段网页的自动关注代码，这是第一次在浏览器控制台上直接操作，有些新奇。</li>
</ul>
<h4 id="第十五周（2-x2F-27-3-x2F-3）"><a href="#第十五周（2-x2F-27-3-x2F-3）" class="headerlink" title="第十五周（2&#x2F;27 - 3&#x2F;3）"></a>第十五周（2&#x2F;27 - 3&#x2F;3）</h4><h6 id="Monday-13"><a href="#Monday-13" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
和后端拉了个会。</p>
<p>首页有一小区域是商品，原本以为既然是商品，那就调用sku的接口就好了，但后端只有通过spuId去获得sku的接口。</p>
<p>可是一个spu会对应多个sku，那我进入商品详情页时渲染哪一个sku的数据呢？现在的做法就是这一块区域设置一个spuId对应一个skuId，有后台管理可以设置。首页的商品key绑定spuId，对应商品详情用spuId请求sku信息。</p>
</li>
</ul>
<h6 id="Tuesday-13"><a href="#Tuesday-13" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
做后端数据接入前端的处理。</p>
<p>比如说购物车的数据我们从后端拿，那么渲染结构不能直接设置为获取的数据，否则会出现购物车商品删不掉、勾选异常等问题。</p>
<p>前端用的是Vuex或本地的数据，那么此时这两者的数据就要更新为获取的后端数据，之后的crud不仅是请求上的，同时要注意本地数据的同步。</p>
</li>
</ul>
<h6 id="Wednesday-11"><a href="#Wednesday-11" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
分类接口，首先是获取一级分类categoryId，点击该菜单时请求指定分类（携参一级categoryId），得到二级菜单数据，然后可以渲染和遍历二级、三级分类。</p>
<p>对于三级分类而言，点击进入商品详情。之前都是通过spuId请求商品信息，有一个搜索接口，可以分别通过categoryId等一系列参数请求商品信息。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
之后要解决一下Git分支合并、变基的冲突问题，调整规范。</p>
<p>比方说我的A分支和另一个人的B分支都在同时编写，但现在B分支的一些功能要用到我A分支新提供的功能或API，就要变基rebase到我的分支上（在我的A分支的代码基础上开发，但还是在它的B分支上操作，同时提交或合并B分支的代码）。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
购物车修改数量的请求并不是直接赋值给后端字段的，数字加减框&lt;变化后的值&gt; - &lt;当前的值&gt; 的数值为正，则给后端字段加&lt;差值&gt;。减类推。</p>
<p>同时请求成功后，也要用差值给本地的count字段更新。这样确保购物车的商品&lt;当前的值&gt;不总是为1，下次请求不会出现前后端数据不对的情况。</p>
</li>
</ul>
<h6 id="Thursday-13"><a href="#Thursday-13" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
记录一个Bug。</p>
<blockquote>
<p>&lt;分类进入的商品详情页&gt;和&lt;商品卡片进入的商品详情页&gt;，通过不同接口获得商品数据对象cate3Goods和detailGoods，需要传递给子组件渲染。</p>
<p>一开始能正常使用，过了会就渲染不出来了，以下两种方式都只能传递第一个数据对象detailGoods给子组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	首先对象不能调用length属性，typeof &#123;&#125;.length的值为&quot;undefined&quot;</span></span><br><span class="line"><span class="comment">	undefined类型和number类型比较时，会将undefined转换为NaN和number数值比较</span></span><br><span class="line"><span class="comment">	所以全不等返回true，总是传递第一个数据对象</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">card-description</span> <span class="attr">:goods</span>=<span class="string">&quot;detailGoods.length!==0 ? detailGoods : cate3Goods&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">card-description</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 原因：对象转布尔值，无论有无属性，都是true --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">card-description</span> <span class="attr">:goods</span>=<span class="string">&quot;detailGoods || cate3Goods&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">card-description</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其实也不是Bug，还是Js的基础不扎实。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 解决 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">card-description</span> <span class="attr">:goods</span>=<span class="string">&quot;Object.keys(detailGoods).length!==0 ? detailGoods : cate3Goods&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">card-description</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<h6 id="Friday-12"><a href="#Friday-12" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
订单的流程，初步走了一下，有创建订单、提交订单接口。</p>
<p>可以确定的是提交订单的同时也要走支付，然后通过查询接口判断该订单有无支付</p>
<p>但是创建订单是从购物车进入结算页时就发起，还是在结算页时一并创建订单、提交订单？</p>
<p>之所以怀疑前者，是因为看淘宝从结算页返回购物车时，订单并不会多出一笔。</p>
</li>
</ul>
<p>	</p>
<h4 id="第十六周（3-x2F-6-3-x2F-10）"><a href="#第十六周（3-x2F-6-3-x2F-10）" class="headerlink" title="第十六周（3&#x2F;6 - 3&#x2F;10）"></a>第十六周（3&#x2F;6 - 3&#x2F;10）</h4><h6 id="Monday-14"><a href="#Monday-14" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><input checked disabled type="checkbox"> 准备用uniapp提供的unipay插件去做支付，不仅有微信小程序的，其他方式的支付都有。这个插件使用的是相当于后端功能的云函数，也包括云数据库等，直接开箱用（可以用免费版）。把实例项目跑通。</li>
</ul>
<h6 id="Tuesday-14"><a href="#Tuesday-14" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
把插件接入到项目里，就是报配置信息的错。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
后端出大问题了，接口调用响应速度不稳定，20s才获得数据，还不一定成功。</p>
<p>我调用一个接口三四次才成功，但层级一多，最后的调试结果还不一定是我希望的，又得重来。</p>
</li>
</ul>
<h6 id="Wednesday-12"><a href="#Wednesday-12" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><input checked disabled type="checkbox"> 搞不明白这个unipay的配置，既然后端说支付的接口已经准备好了，就直接用后端的吧。后端希望我用这个插件，是因为如果将来希望引入另一种支付方式，他就不用再写一套了。</li>
<li><input checked disabled type="checkbox"> 后端现在在解决接口的问题。微信支付我暂时没有办法去调试接入。</li>
<li><input checked disabled type="checkbox"> 收货地址有一个“我点击switch开关设置默认地址时，屏幕闪烁”的问题，但我一看拉取我代码的同学的分支，他电脑上正常运行、没有异常。不明所以的问题，等到本地图片等资源传到云端，可以真机调试时，就可以确定是不是代码的问题了。</li>
</ul>
<h6 id="Thursday-14"><a href="#Thursday-14" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><input checked disabled type="checkbox"> 我把本地的图片都干掉后去真机调试，之前微信开发工具上出现的闪屏问题就消失了。用真机调试好些，不然找Bug半天，居然又不是问题。</li>
</ul>
<h6 id="Friday-13"><a href="#Friday-13" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
因为第一版预备要上的商品只有17个，似乎不算多，所以被提了个需求，商品列表无限循环（类似轮播图）。</p>
</li>
<li><p><input disabled type="checkbox"> 
引入外部字体，调用loadFontFace成功加载，标签也引用了但是界面上就是没有效果。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
在小程序项目的目录下有一个unpackage目录，他似乎是将我们编写的代码进行了编译，给微信开发者工具使用。对于Git中的冲突，真正我们编写的代码引起的冲突就一两个文件，大多都是unpackage导致的冲突。</p>
<p>unpackage应该可由我们的代码来生成，而如果在Git中忽略掉它，可能这个冲突问题好解决很多。</p>
</li>
</ul>
<h4 id="第十七周（3-x2F-13-3-x2F-17）"><a href="#第十七周（3-x2F-13-3-x2F-17）" class="headerlink" title="第十七周（3&#x2F;13 - 3&#x2F;17）"></a>第十七周（3&#x2F;13 - 3&#x2F;17）</h4><h6 id="Monday-15"><a href="#Monday-15" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
解决上周说的unpackage目录导致的分支大量冲突问题。</p>
<blockquote>
<p>在本地.gitignore文件中添加&#x2F;unpackage，提交时忽略这个目录。</p>
<p>但此时远程仓库中已经有unpackage目录了，删除远程仓库对应分支的unpackage目录：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -r 表示递归删除目录下的所有文件、目录</span></span><br><span class="line"><span class="comment">// --cached 表示移除跟踪名单，但保留本地</span></span><br><span class="line">git rm -r <span class="attr">--cached</span> unpackage</span><br></pre></td></tr></table></figure>

<p>再add、commit、push。最后把我的分支提交到master分支时冲突只有两三个文件了。</p>
</blockquote>
<p>我是通过命令行去合并的，首先切换到master分支，再去merge我需要合并的Cookie分支。此时我本地只有一个Cookie分支：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// （√）拉取远程仓库主分支到本地新建master分支</span></span><br><span class="line">git checkout -<span class="selector-tag">b</span> master origin/master</span><br><span class="line"></span><br><span class="line"><span class="comment">// （×）之前一直尝试用以下方法去拉取master分支代码</span></span><br><span class="line"><span class="comment">// 但切换后的新建分支，其实还是和我的Cookie分支代码一样，此时pull只是更新了对应文件的代码</span></span><br><span class="line"><span class="comment">// 并不是我想要的master分支</span></span><br><span class="line">git checkout -<span class="selector-tag">b</span> master</span><br><span class="line">git pull origin master</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决冲突后要重新add、commit，才能继续合并</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="Tuesday-15"><a href="#Tuesday-15" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
分包与预加载。</p>
<p>创建多个分包，同时在pages.json文件下与subPackages同级别的preloadRule中配置预加载。比如：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 作用是当切换到shop页面时，就提前加载下一级页面资源，而不是点击进入时才下载。</span></span><br><span class="line">&quot;preloadRule&quot;: &#123;</span><br><span class="line">    &quot;pages/shop/shop&quot;:&#123;</span><br><span class="line">        &quot;network&quot;: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">        <span class="string">&quot;packages&quot;</span>:[<span class="string">&quot;subpkg_goods&quot;</span>]	// 分包的root属性</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><input checked disabled type="checkbox"> 
除预加载外，解决页面抖动还有一方面：样式设置的数据是通过页面onLoad获取的数据，不应该采取这种方式，数据的获取、更新有一段时间间隔。</p>
</li>
</ul>
<h6 id="Wednesday-13"><a href="#Wednesday-13" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
收货地址。</p>
<blockquote>
<p>&lt;添加收货地址&gt;接口是不需要addrId参数的，此后的&lt;更新&gt;、&lt;删除&gt;需要这个参数。</p>
<p>问题在于本地添加地址后，现在在&lt;地址列表&gt;页面的每一项是以index作为key绑定值，点击对应项如何请求更新后端对应地址？</p>
<p>调用&lt;获取地址列表&gt;接口时做两个判断：</p>
<ol>
<li><p>本地没有地址时</p>
<p>此时就使用接口获取的数据存储到本地。</p>
</li>
<li><p>本地有地址时</p>
<p>外层循环对本地userAddress遍历，内层循环对&lt;获取地址列表&gt;请求的数据res遍历。</p>
<p>将本地userAddress的收货人、电话、详细地址等都转为一串字符串localStr，res同理创建resStr。两者相等时，把res的遍历对象的addrId赋值到本地userAddress的对象上。</p>
</li>
</ol>
<p>&lt;获取地址列表&gt;接口调用位置：</p>
<p>除了&lt;地址列表&gt;页面onLoad时调用&lt;获取收货地址&gt;接口外，&lt;添加收货地址&gt;与&lt;修改收货地址&gt;navigateBack返回上一层页面的同时，也调用&lt;获取收货地址&gt;接口。</p>
<p>&lt;地址列表&gt;页面的key就用addrId绑定。</p>
</blockquote>
<h6 id="Thursday-15"><a href="#Thursday-15" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
处理加购逻辑。</p>
<p>如果购物车中已经有当前&lt;商品详情页&gt;中的商品了，那么再点击加购，应该是增加对应购物车商品的数量。</p>
<p>和昨天说的收货地址列表需要addrId一样，购物车列表需要cartItemId做添加、删除、修改请求。同样的方法，在请求&lt;购物车列表&gt;接口时把商品数据添加进本地。</p>
<p>请求&lt;购物车列表&gt;接口的地方：判断购物车中该商品不存在，&lt;商品详情页&gt;点击加购、请求加购接口成功后；</p>
<p>如果判断购物车该商品存在，则调用修改数量接口，同时修改本地对应商品的数量（既然已存在，就说明之前已请求&lt;购物车列表&gt;添加到本地，有cartItemId。通过cartItemId可以找到本地的商品）。</p>
</li>
</ul>
<h6 id="Friday-14"><a href="#Friday-14" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
页面抖动的解决还有一方面：view没有设置高度，是根据内容高度来设置自身高度的。所以获取到数据前后高度不一样，会发生抖动。</p>
<p>顺便做了骨架屏，获取到数据前用css效果等待，而不是白屏。（之前有一期&lt;Web 50Projects 4&gt;刚好是这个）</p>
</li>
</ul>
</li>
</ul>
<h4 id="第十八周（3-x2F-20-3-x2F-25）"><a href="#第十八周（3-x2F-20-3-x2F-25）" class="headerlink" title="第十八周（3&#x2F;20 - 3&#x2F;25）"></a>第十八周（3&#x2F;20 - 3&#x2F;25）</h4><h6 id="Monday-16"><a href="#Monday-16" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
微信支付</p>
<ol>
<li><p>用户通过购物车&lt;结算&gt;或者详情页&lt;立即购买&gt;，进入支付信息页。</p>
<ul>
<li>调用&lt;结算，生成订单接口&gt;，可以渲染预备支付的商品数据。</li>
</ul>
</li>
<li><p>在选择收货地址后，点击支付信息页中&lt;支付&gt;。</p>
<ul>
<li>调用&lt;提交订单接口&gt;，并返回平台订单号orderId。此时后台会有该笔订单的记录。支付成功与否，在小程序端订单模块展示给用户。</li>
<li>接着掉用&lt;平台的支付订单接口&gt;，目的是拿到微信API——requestPayment需要的支付参数，如package、paySign等。</li>
<li>调用uni.requestPayment()，配置参数。调用成功会自动弹出微信的收银台。</li>
</ul>
</li>
<li><p>&lt;订单模块&gt;见下。</p>
<ul>
<li><p>用户取消的订单在时限内可以&lt;继续支付&gt;，但此时不再是&lt;结算、生成订单接口&gt;、&lt;提交订单接口&gt;流程了，此时该订单已有对应的key值绑定，即订单Id。根据orderId查询订单信息，渲染支付信息页，最后的支付同样是根据orderId直接支付。</p>
<p>订单中的&lt;取消订单&gt;、&lt;确定收货&gt;也就是根据orderId请求。</p>
</li>
</ul>
</li>
</ol>
<p>补充（对于后端而言）：</p>
<ol>
<li>在前端调用&lt;提交订单接口&gt;，即后端生成平台订单时，后端向微信支付系统请求&lt;创建订单&gt;，微信生成预付单标识返回后端，后端再生成并存储附加参数，等待前端调用&lt;平台的支付订单接口&gt;获得参数。</li>
<li>前端支付时，后端也会异步得到微信的支付结果，此时后端修改平台订单的状态。</li>
</ol>
</li>
<li><p><input checked disabled type="checkbox"> 
订单列表中要展示所有的订单，一个订单可能有多个商品。所以结构是&lt;订单页&gt;中使用订单组件<order-card>，<order-card>中使用商品组件<goods-card>。</goods-card></order-card></order-card></p>
<p>数据关系是：<order-card>使用v-for遍历的订单数据，同时绑定并向下传递key值：订单Id。订单数据中的商品数据字段遍历给<goods-card>使用。</goods-card></order-card></p>
<p>头部切换导航时如&lt;待支付&gt;、&lt;待发货&gt;，对应的<order-card>加上v-if条件进行展示：</order-card></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;-- </span><br><span class="line">    currentNav：头部导航索引</span><br><span class="line">    item.isPayed：是否支付成功</span><br><span class="line">	item.status：订单数据中的状态字段，由此判断待收货、待发货等</span><br><span class="line">    toDone：布尔值，子触父changeStatus()处理确定收货、取消订单、继续付款等业务和请求后</span><br><span class="line">    		改变toDone值使订单消失。</span><br><span class="line">--&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">order-card</span> <span class="attr">v-if</span>=<span class="string">&quot;currentNav==3 &amp;&amp; item.isPayed==1 &amp;&amp; item.status==3 &amp;&amp; toDone&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">:currentNavItem</span>=<span class="string">&quot;item&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">:selectNavBar</span>=<span class="string">&quot;currentNav&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">:orderId</span>=<span class="string">&quot;item.orderId&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">changeStatus</span>=<span class="string">&quot;changeStatus()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">order-card</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><input checked disabled type="checkbox"> 
提交后又在我的Cookie分支更新代码，但这时想切换到另一个分支，帮他合并到主分支上。</p>
<p>如果不对新更新的这部分代码做处理，提交会报错失败。</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// （×）一种是直接把我的Cookie分支提交上去，但是我的新增代码非完整功能，不建议</span></span><br><span class="line"><span class="comment">// （√）第二种暂存，保证工作树干净，可以提交</span></span><br><span class="line">git stash		<span class="comment">// 暂存</span></span><br><span class="line">git stash pop	<span class="comment">// 取出暂存</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><input checked disabled type="checkbox"> 
后端的金额数据乘100的原因在于浮点数存在精度问题，可能导致最后计算金额错误。所以前端要除以100得到实际金额。</p>
</li>
</ul>
<h6 id="Tuesday-16"><a href="#Tuesday-16" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><input checked disabled type="checkbox"> 处理订单模块的一些细节。</li>
</ul>
<h6 id="Wednesday-Friday-1"><a href="#Wednesday-Friday-1" class="headerlink" title="Wednesday - Friday"></a>Wednesday - Friday</h6><ul>
<li><p><input checked disabled type="checkbox"> 
加购抛物线动画。</p>
<p>需求：当点击&lt;加购&gt;，屏幕中央播放GIF图，用于用户网络延迟时展示。请求成功后取消GIF图播放，开始进行动画——从屏幕中央抛出&lt;加购球&gt;进行抛物线运动，落点为左下角的&lt;购物车图标&gt;。</p>
<p>GIF图通过popup组件直接展示在屏幕中央。</p>
<p>&lt;加购球&gt;抛物线动画：</p>
<p>一、进行抛物线轨迹的计算</p>
</li>
</ul>
<p> 说明：以屏幕中心建立坐标轴，开口向下的抛物线公式为 x^2^ &#x3D; -2py，求出这个参数p（即p &#x3D; - x^2^&#x2F;2y）得抛物线。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> that = <span class="variable language_">this</span>	<span class="comment">// 保留this指向，后面掉方法用</span></span><br><span class="line"><span class="comment">// 查询购物车图标位置</span></span><br><span class="line">uni.<span class="title function_">createSelectorQuery</span>()</span><br><span class="line">    .<span class="title function_">select</span>(<span class="string">&quot;.selectEle&quot;</span>)	<span class="comment">// 购物车图标的类选择器</span></span><br><span class="line">    .<span class="title function_">boundingClientRect</span>(<span class="keyword">function</span>(<span class="params">rect</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; left, width &#125; = rect	<span class="comment">// left：左距离值（屏幕左上角圆点）</span></span><br><span class="line">        <span class="keyword">const</span> image_left = <span class="title class_">Math</span>.<span class="title function_">round</span>(left + width/<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">const</span> image_bottom = <span class="title class_">Math</span>.<span class="title function_">round</span>(left + width)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置&lt;加购球&gt;落点，即&lt;购物车图标&gt;头部线中点的坐标（相对屏幕中心）</span></span><br><span class="line">        <span class="keyword">const</span> cartIconPosition = &#123;<span class="attr">left</span>: image_left, <span class="attr">bottom</span>: image_bottom&#125;</span><br><span class="line"></span><br><span class="line">        uni.<span class="title function_">getSystemInfo</span>()</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">				<span class="comment">// 动态获取屏宽、屏高（适配）</span></span><br><span class="line">                <span class="keyword">const</span> &#123;screenWidth, screenHeight&#125; = res[<span class="number">1</span>]</span><br><span class="line">                <span class="comment">// 屏幕中心圆点</span></span><br><span class="line">                <span class="keyword">const</span> centerPoint = &#123;<span class="attr">left</span>: screenWidth/<span class="number">2</span>, <span class="attr">top</span>: screenHeight/<span class="number">2</span>&#125;</span><br><span class="line">                <span class="comment">// 将屏幕中心圆点视为坐标系圆点，则在抛物线上的点为（相对值）</span></span><br><span class="line">                <span class="keyword">const</span> inParabola = &#123;</span><br><span class="line">                    <span class="attr">x</span>: - (centerPoint.<span class="property">left</span> - cartIconPosition.<span class="property">left</span>),</span><br><span class="line">                    <span class="comment">// y理论上不用减最后的width，但是达不到落点为cartIconPosition坐标的效果，试出来的</span></span><br><span class="line">                    <span class="attr">y</span>: - (centerPoint.<span class="property">top</span> - cartIconPosition.<span class="property">bottom</span> - width )</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 得到抛物线参数，即得到抛物线。函数见下</span></span><br><span class="line">                <span class="keyword">const</span> p = customAnimation.<span class="title function_">parabola</span>(inParabola)</span><br><span class="line">                <span class="comment">// 调用动画</span></span><br><span class="line">                <span class="keyword">const</span> addCartAnimationParam = &#123;p, <span class="attr">finishPoint</span>: inParabola&#125;</span><br><span class="line">                that.<span class="title function_">addCartAnimation</span>(addCartAnimationParam)</span><br><span class="line"></span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;).<span class="title function_">exec</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取抛物线参数p</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> (x,y) 经过的点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parabola</span>(<span class="params">passPoint</span>)&#123;</span><br><span class="line">	<span class="keyword">const</span> &#123;x, y&#125; = passPoint</span><br><span class="line">	<span class="keyword">const</span> p = -x*x / (<span class="number">2</span>*y)</span><br><span class="line">	<span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  二、动画的实际执行</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 动画执行</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> p 抛物线参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> finishPoint 动画终点坐标</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_">addCartAnimation</span>(<span class="params">param</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;p, finishPoint&#125; = param</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> animation = uni.<span class="title function_">createAnimation</span>(&#123;</span><br><span class="line">        <span class="attr">duration</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">timingFunction</span>: <span class="string">&quot;ease&quot;</span>,</span><br><span class="line">        <span class="attr">transformOrigin</span>: <span class="string">&quot;50% 50%&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> animation_cart = uni.<span class="title function_">createAnimation</span>(&#123;</span><br><span class="line">        <span class="attr">duration</span>: <span class="number">220</span>,</span><br><span class="line">        <span class="attr">timingFunction</span>: <span class="string">&quot;linear&quot;</span>,</span><br><span class="line">        <span class="attr">transformOrigin</span>: <span class="string">&quot;50% 50%&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">animation</span> = animation</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 抛物线 x*x = -2*p*y</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&gt;=finishPoint.<span class="property">x</span>; i=i-<span class="number">5</span>)&#123;</span><br><span class="line">        <span class="comment">// 一段一段的移动。translate的y值要取反，正值向下移动</span></span><br><span class="line">        animation.<span class="title function_">translate</span>(i, i*i/(<span class="number">2</span>*p)).<span class="title function_">scale</span>(<span class="number">1</span>+<span class="number">5</span>*i/<span class="number">1000</span>).<span class="title function_">step</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">animationData</span> = animation.<span class="title function_">export</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 监听&lt;加购球&gt;的状态</span></span><br><span class="line"><span class="comment">     * 如果监听元素&lt;加购球&gt;&quot;.centerScreen&quot;进入观察区域&quot;.buyNow&quot;，则触发回调</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">        uni.<span class="title function_">createIntersectionObserver</span>(<span class="variable language_">this</span>)</span><br><span class="line">            .<span class="title function_">relativeTo</span>(<span class="string">&quot;.buyNow&quot;</span>, &#123;<span class="attr">top</span>: <span class="number">0</span>&#125;)</span><br><span class="line">            .<span class="title function_">observe</span>(<span class="string">&quot;.centerScreen&quot;</span>, <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            </span><br><span class="line">                <span class="comment">// 恢复&lt;加购球&gt;初始状态。</span></span><br><span class="line">            	<span class="comment">// translate是相对于初始位置，而不是改变后的自身位置</span></span><br><span class="line">                animation.<span class="title function_">translate</span>(<span class="number">0</span>).<span class="title function_">step</span>(&#123;<span class="attr">duration</span>: <span class="number">10</span>, <span class="attr">timingFunction</span>:<span class="string">&quot;step-start&quot;</span>&#125;)</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">animationData</span> = animation.<span class="title function_">export</span>()</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">animationFinish</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 购物车图标shake</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">animation</span> = animation_cart</span><br><span class="line">                <span class="keyword">const</span> cart_duration = <span class="number">220</span></span><br><span class="line">                animation_cart.<span class="title function_">rotate</span>(<span class="number">26</span>).<span class="title function_">step</span>(&#123;<span class="attr">uration</span>: cart_duration, <span class="attr">timingFunction</span>: <span class="string">&quot;ease-in&quot;</span>&#125;)</span><br><span class="line">                animation_cart.<span class="title function_">rotate</span>(-<span class="number">26</span>).<span class="title function_">step</span>(&#123;<span class="attr">duration</span>: cart_duration&#125;)</span><br><span class="line">                animation_cart.<span class="title function_">rotate</span>(<span class="number">0</span>).<span class="title function_">step</span>(&#123;<span class="attr">duration</span>: cart_duration, <span class="attr">timingFunction</span>: <span class="string">&quot;ease-out&quot;</span>&#125;)</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">animationCartData</span> = animation_cart.<span class="title function_">export</span>()</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 恢复购物车图标</span></span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                    animation_cart.<span class="title function_">rotate</span>(<span class="number">0</span>).<span class="title function_">step</span>()	</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">animationCartData</span> = animation_cart.<span class="title function_">export</span>()</span><br><span class="line">                &#125;,<span class="number">3</span>*cart_duration)</span><br><span class="line">            &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  三、补充说明</p>
  <figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据animationFinish的状态显示隐藏元素</span></span><br><span class="line">&lt;image :animation=<span class="string">&quot;animationData&quot;</span> </span><br><span class="line">        :class=<span class="string">&quot;[&#x27;centerScreen&#x27;,animationFinish ? &#x27;hideView&#x27; : &#x27;showView&#x27;]&quot;</span></span><br><span class="line">        src=<span class="string">&quot;../../static/icons/brand.png&quot;</span>&gt;&lt;/image&gt;</span><br></pre></td></tr></table></figure>

<h4 id="第十九周（3-x2F-27-3-x2F-31）"><a href="#第十九周（3-x2F-27-3-x2F-31）" class="headerlink" title="第十九周（3&#x2F;27 - 3&#x2F;31）"></a>第十九周（3&#x2F;27 - 3&#x2F;31）</h4><h6 id="Monday-17"><a href="#Monday-17" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
代码写到一半（新增了一个文件），突然想把另一个分支合到主分支上，所以用了git stash，把我的代码存到暂存区。</p>
<p>等我处理完，切回我的分支，执行git stash pop，取出存在暂存区中的代码。</p>
<p>但是，这个文件丢失了！</p>
<blockquote>
<p>原因：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在我执行git stash前并没有git add，后者的作用是追踪文件。</span><br><span class="line">也就是说，之所以会发生丢失的原因，并不是git stash失败，而是它只暂存了我已有追踪的文件。</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<h6 id="Tuesday-17"><a href="#Tuesday-17" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><input checked disabled type="checkbox"> 提需求：<ol>
<li>小程序某页面的小图标、优惠券底图。</li>
<li>请求时对应场景的搜索Gif、等待加载Gif。</li>
<li>积分兑换商城显示优惠券类型图：待开启兑换（未到达设置的优惠券可兑换时间）、全场通用、商品券（指定商品）、品类券（指定分类）。</li>
</ol>
</li>
</ul>
<h6 id="Wednesday-14"><a href="#Wednesday-14" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
加购抛物线流畅度优化。</p>
<p>通过改变动画的过程时间duration。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
优惠券在支付订单中使用与禁用的逻辑：</p>
<ol>
<li>当前订单的总金额 &gt; 优惠券的最小使用条件（比如&lt;满40减8&gt;中的40）</li>
<li>当前订单的总金额 &gt; 优惠券的面额（比如&lt;满40减8&gt;中8，否则会出现最终金额为负数）</li>
</ol>
<blockquote>
<p>说明：</p>
<p>&lt;使用优惠券&gt;就是减去当前订单的使用的优惠券金额。</p>
<p>所以需要用到订单orderId和优惠券couponId，现在的问题就是当前支付页面只有订单信息，但还未提交订单，也就是说目前拿不到订单orderId。如果我把这个&lt;提交订单&gt;（用户点击支付按钮时）提前以获得订单orderId，使用优惠券，结果就是用户进入订单页再返回（还未到支付），生成待支付的订单的流程也同步提前了（之前是根据是否点击支付、支付是否成功来生成支付订单）。</p>
<p>以上流程可以实现，但我要改很多地方，所以采用以下方法：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;我的优惠券&gt;数据存放到本地，本地添加isChecked字段，根据勾选状态isChecked的true值找到对应的couponId。</span><br><span class="line">在用户点击支付后，即&lt;提交订单&gt;拿到orderId后，请求&lt;使用优惠券&gt;接口，成功后再进行最终的支付requestPayment。</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<h6 id="Thursday-16"><a href="#Thursday-16" class="headerlink" title="Thursday"></a>Thursday</h6><ul>
<li><input checked disabled type="checkbox"> 对本地的静态资源分了一下类，准备用CDN进行图片资源加载（不在本地）。微信小程序的打包上传有主包大小的限制，主要是处理这个问题。</li>
<li><input checked disabled type="checkbox"> 重构订单模块中，点击头部导航对应渲染订单的逻辑。</li>
<li><input checked disabled type="checkbox"> 触底加载下页数据的节流阀。</li>
</ul>
<h6 id="Friday-15"><a href="#Friday-15" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
在&lt;微信开发者工具&gt;点击上传前，首先在<HBuilderX>中点击发行，作用是减少运行文件的体积。</HBuilderX></p>
<p>由于&lt;微信开发者工具&gt;没有进行域名合法的校验（本地设置配置），所以可以直接请求后端接口。但在正式环境中，不依赖&lt;微信开发者工具&gt;的小程序必须解决域名的问题，即在&lt;公众平台&gt;配置服务器域名（request合法域名），需要备案。</p>
</li>
</ul>
<h4 id="第二十周（4-x2F-3-4-x2F-7）"><a href="#第二十周（4-x2F-3-4-x2F-7）" class="headerlink" title="第二十周（4&#x2F;3 - 4&#x2F;7）"></a>第二十周（4&#x2F;3 - 4&#x2F;7）</h4><h6 id="Monday-18"><a href="#Monday-18" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
版本回退。</p>
<p>把同学的分支推送到主分支上时，我拉取下来运行，发现他的代码引起了一个Bug。</p>
<p>那么这一次提交肯定不能留在仓库里，需要去除。</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查看每一次提交记录信息，包括提交Id</span></span><br><span class="line">git log <span class="attr">--oneline</span></span><br><span class="line"><span class="comment">// 将本地的代码回退到指定commitId，指定commitId之后的提交都被清除</span></span><br><span class="line">git reset <span class="attr">--hard</span> <span class="selector-attr">[commitId]</span></span><br><span class="line"><span class="comment">// 最后提交到远程分支，-f意为强制(force)。远程分支commitId后的提交也清除</span></span><br><span class="line">git push -f origin master</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	补充1：</span></span><br><span class="line"><span class="comment">	我在使用git reset时未使用--hard，</span></span><br><span class="line"><span class="comment">	即git reset，此时默认等同于git reset --mixed。</span></span><br><span class="line"><span class="comment">	这意味着工作内容（代码）保留，只把提交信息退回到指定版本。</span></span><br><span class="line"><span class="comment">	这就解释了当时代码Bug还保留。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	--hard表示把代码和提交信息都回退到指定版本。</span></span><br><span class="line"><span class="comment">	(慎用：会删除commitId后所有的新提交，因为我确定远程仓库这一部分的提交不会被使用，</span></span><br><span class="line"><span class="comment">	也没有正在协同使用，所以能直接删掉。)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	补充2：</span></span><br><span class="line"><span class="comment">	git push -f 推送前，虽然是强制推送，</span></span><br><span class="line"><span class="comment">	但要先在GitLab后台设置master分支为unproduct，否则也无法推送（权限原因）</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><input checked disabled type="checkbox"> 
云图片路径。</p>
<p>图片放到云端后，需要通过地址去访问，我在一个Js文件中配置了图片域名picDomain，在使用到云图片的页面导入import这个picDomain，赋值给本地data中的imageDomain。</p>
<p>标签内使用：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;image class=&quot;shop-logo&quot; :src=<span class="string">&quot;imageDomain+&#x27;/info/logo.png&#x27;&quot;</span> mode=<span class="string">&quot;widthFix&quot;</span>&gt;&lt;/image&gt;</span><br></pre></td></tr></table></figure>

<p>虽然图片能正常显示出来，但控制台会报错。</p>
<ol>
<li>路径中的斜杠”&#x2F;“需要转译，即”&#x2F;&#x2F;“。</li>
<li>由于picDomain是由其他文件导入进当前页面，在当前页面渲染时，即image标签内去请求这个图片，页面本地的imageDomain还是初始的””，并没有进行到赋值操作。之所以图片能够显示出来，是此后picDomain加载进来并进行本地赋值，成功请求到正确的图片地址。报错所在就是image标签进行了两次图片请求，第一次imageDomain为空，则请求地址当然错误。</li>
</ol>
<p>最终：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;image class=&quot;shop-logo&quot; :src=<span class="string">&quot;imageDomain ? imageDomain+&#x27;//info//logo.png&#x27; : &#x27;&#x27;&quot;</span> mode=<span class="string">&quot;widthFix&quot;</span>&gt;&lt;/image&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="Tuesday-18"><a href="#Tuesday-18" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
之前的登录是写死的，今天根据微信官方Api——getPhoneNumber获取手机号code并传给后端，用作登录。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
抽屉drawer的Android适配。</p>
<p>实在没找出代码的原因，只能不使用组件，在页面内通过动画上移、下移来实现了。</p>
</li>
</ul>
<h6 id="Wednesday-15"><a href="#Wednesday-15" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><input checked disabled type="checkbox"> 休假。</li>
</ul>
<h6 id="Thursday-17"><a href="#Thursday-17" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
把封装的接口请求返回为一个Promise，这样在逻辑上，上一个接口请求成功后才会进行下一个接口请求（通过then）。</p>
<p>之前是在一个接口的成功回调函数中调用另一个接口，但是在做注册登录时，接口太多了，一是耦合太高，一个地方改了后面都要改，二是回调地狱。</p>
<p>同时这些接口只能同步进行，而非异步，其中最终的注册或登录接口的参数依赖于此前分别获得参数的接口，少一个都无法请求成功。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
前端请求的后端接口为api.abc.com，但SSL证书却是给域名abc.com配置的，所以正式环境无法请求接口。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
后端给我返回的优惠券数据，并没有汇总效果，比如同一个优惠券领取多次，在&lt;我的优惠券&gt;中该数据并没有个数count字段，而是分开的一条条数据，尽管优惠券id一样。</p>
<blockquote>
<p>所在在前端实现汇总，增加count字段。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 获取后端返回优惠券数据，计算每个优惠券个数</span></span><br><span class="line"><span class="comment">* @param &#123;Array&#125; coupons </span></span><br><span class="line"><span class="comment">* return countById 键值为id和个数</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">countCouponIds</span>(<span class="params">coupons</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> countById = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;coupons.<span class="property">length</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">const</span> id = coupons[i].<span class="property">couponId</span></span><br><span class="line">        <span class="keyword">if</span>(countById[id])&#123;</span><br><span class="line">            countById[id]++</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            countById[id] = <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> countById</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.在请求到后端的优惠券数据后，先通过&lt;countCouponIds&gt;方法，得出每个优惠券id对应的个数（键值对）</span></span><br><span class="line"><span class="keyword">const</span> countById = <span class="variable language_">this</span>.<span class="title function_">countCouponIds</span>(res.<span class="property">couponUser</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.在本地优惠券数据discount中遍历查找&lt;countById&gt;中的每一个优惠券id</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> id <span class="keyword">in</span> countById)&#123;</span><br><span class="line">    <span class="comment">// find方法查找第一个符合条件的元素，找到返回元素本身，否则返回undefined</span></span><br><span class="line">    <span class="keyword">const</span> isExist = <span class="variable language_">this</span>.<span class="property">discount</span>.<span class="title function_">find</span>(<span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">couponId</span> == id)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(isExist)&#123;</span><br><span class="line">        <span class="comment">// 如果存在，且个数不等，则更新个数</span></span><br><span class="line">        <span class="keyword">if</span>(isExist.<span class="property">count</span>!==countById[id])&#123;</span><br><span class="line">            <span class="keyword">const</span> couponIdAndCount = &#123;<span class="attr">count</span>: countById[id], <span class="attr">couponId</span>: id&#125;</span><br><span class="line">            <span class="comment">// Vuex根据id修改count</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">updateCount</span>(couponIdAndCount)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 不存在，则直接添加</span></span><br><span class="line">        <span class="keyword">const</span> newDiscount = res.<span class="property">couponUser</span>.<span class="title function_">find</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">couponId</span>==id)</span><br><span class="line">        newDiscount.<span class="property">count</span> = countById[id]</span><br><span class="line">        <span class="comment">// 本地勾选</span></span><br><span class="line">        newDiscount.<span class="property">isChecked</span> = <span class="literal">false</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">addDiscount</span>(newDiscount)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><input checked disabled type="checkbox"> 
地址列表点击设置默认。</p>
<p>当前页面列表用本地数据遍历渲染，修改某一列表项数据时，虽然本地已经修改，但是页面未做到响应式。</p>
<p>修改的字段处于对象数据中，不仅是数组，对象的修改也需要用Vue.set或深拷贝。</p>
<p>眨眼的功夫，列表点击直接设置默认的效果又没了（数据又不能响应式了？）。改成让用户直接跳转到内容详情，手动更改switch。</p>
</li>
</ul>
<h6 id="Friday-16"><a href="#Friday-16" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
给各个需要等待请求反馈的按钮加上Popup Gif，优化用户等待效果。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
用户登录时设置默认昵称、头像，但要请求&lt;用户头像昵称&gt;接口，判断后端是否有头像、昵称，有则复用，无则默认。</p>
<p>否则用户修改昵称头像后再次登录还是默认。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
解决修改地址详情，将默认switch置为false，不提交却导致数据改变的Bug。</p>
</li>
</ul>
<h4 id="第二十一周（4-x2F-10-4-x2F-14）"><a href="#第二十一周（4-x2F-10-4-x2F-14）" class="headerlink" title="第二十一周（4&#x2F;10 - 4&#x2F;14）"></a>第二十一周（4&#x2F;10 - 4&#x2F;14）</h4><h6 id="Monday-19"><a href="#Monday-19" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
在封装的请求中根据后端的状态码判断用户是否登录失效，用switchTab点击确认跳转到&lt;个人中心&gt;页，虽然本地token等数据已清除，但页面内还是保持有数据，未刷新。</p>
<p>改用reLaunch，关闭所有页面，打开某页面（tabBar页也可）。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
解决页面内自定义底部抽屉的遮罩mask，使页面操作无效的Bug。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
navigateBack返回多级屏幕闪黑。</p>
<p>由A页面依次进入B、C、D页面，在D页面的页面卸载OnUnload生命周期中调用navigateBack返回多级页面或其他路由事件，都会导致页面闪黑。</p>
<p>将原生导航栏换成了自定义导航栏，将左上角的返回按钮设置点击事件，navigateBack向上跳回两级页面，此时没有问题。（因为支付成功后来到&lt;支付成功页&gt;，就不能让用户再回到&lt;支付信息页&gt;了）。</p>
</li>
</ul>
<h6 id="Tuesday-19"><a href="#Tuesday-19" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
昨天的自定义导航栏点击返回没问题，但是如果点手机底部自带的返回，还是返回上一级页面，不符合业务逻辑，所以还得修改。同时，自定义导航栏的高度是通过数据加载的，在页面渲染过程发生抖动。</p>
<p>没解决成功，丢给另一个前端同学了。</p>
</li>
</ul>
<h6 id="Wednesday-16"><a href="#Wednesday-16" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
微信临时头像。</p>
<p>用户选择头像后，前端获取到的头像地址是临时地址，过了一定时限，用户不能访问。</p>
<p>则需要将图片上传到后端（见官方API，uni.uploadFile），用户访问后端的头像地址。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要注意的点：不能用户选择完头像，就立即上传，而是等他点击确认按钮再上传。	</span></span><br><span class="line"><span class="comment">// 修改后端用户信息逻辑</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">tempNickname</span>.<span class="title function_">trim</span>()) &#123;</span><br><span class="line">    <span class="comment">// 1.未改变：返回</span></span><br><span class="line">    <span class="comment">// temp表示当前页用户修改的昵称和头像，后者表示上次由后端返回的昵称和头像。onload时默认将后者赋值给前者</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">tempNickname</span>.<span class="title function_">trim</span>() + <span class="variable language_">this</span>.<span class="property">tempAvatar</span> == <span class="variable language_">this</span>.<span class="property">nickName</span> + <span class="variable language_">this</span>.<span class="property">avatar</span> ) </span><br><span class="line">        <span class="keyword">return</span> uni.<span class="title function_">navigateBack</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.只改变昵称：直接修改后端（沿用原来图片）</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">tempAvatar</span>==<span class="variable language_">this</span>.<span class="property">avatar</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">tempNickname</span>.<span class="title function_">trim</span>()!=<span class="variable language_">this</span>.<span class="property">nickName</span>) </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">updateUserNicknameAvatar</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setAvatar</span>(<span class="variable language_">this</span>.<span class="property">resImage</span>)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setNickName</span>(<span class="variable language_">this</span>.<span class="property">tempNickname</span>)</span><br><span class="line">            uni.<span class="title function_">navigateBack</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3.只修改头像：上传头像并修改后端（沿用原来昵称）</span></span><br><span class="line">    <span class="comment">// beforeUpload上传头像方法，包含了updateUserNicknameAvatar修改后端的请求</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">tempNickname</span>==<span class="variable language_">this</span>.<span class="property">nickName</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">tempAvatar</span>!=<span class="variable language_">this</span>.<span class="property">avatar</span>) <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">beforeUpload</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.头像昵称都修改：上传头像并修改后端（获取最新头像、昵称）</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">beforeUpload</span>()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;还未填写昵称&quot;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&quot;none&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="Thursday-18"><a href="#Thursday-18" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
数据预拉取</p>
<blockquote>
<p>作用：在进入小程序前的加载过程，就提前将部分数据请求到本地，减少用户等待时间。</p>
<p>步骤：</p>
<ol>
<li><p>在&lt;微信公众平台&gt;设置数据预拉取请求的接口，注意是https。</p>
</li>
<li><p>&lt;微信开发者工具&gt;本地设置打开&lt;数据预加载&gt;。</p>
</li>
<li><p>在App.vue的<em><strong>onLaunch</strong></em>生命周期中设置请求token，并请求。（先加载App.vue，再加载其他页面）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">setBackgroundFetchToken</span>(&#123;</span><br><span class="line">    <span class="attr">token</span>: <span class="string">&quot;HELLO WORLD&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> that = <span class="variable language_">this</span></span><br><span class="line">uni.<span class="title function_">getBackgroundFetchData</span>(&#123;</span><br><span class="line">    <span class="attr">fetchType</span>: <span class="string">&quot;pre&quot;</span>,		<span class="comment">// pre预加载，periodic周期（12h）更新</span></span><br><span class="line">    <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> goods = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">fetchedData</span>)</span><br><span class="line">        <span class="comment">// 预加载数据Vuex存入本地</span></span><br><span class="line">        that.<span class="title function_">setLocalShopGoods</span>(goods.<span class="property">data</span>.<span class="property">list</span>[<span class="number">0</span>].<span class="property">spus</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>渲染时使用本地数据，而非接口请求。但并不取消该接口的请求。</p>
</li>
<li><p>也就是说，在进入首页前，通过预加载请求到了数据，进到首页后，仍然发起请求。（原因见下）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  	请求到的数据的字符串，与本地预拉取到的数据的字符串不相等，表示此时从后端请求到的数据发生了更新。</span></span><br><span class="line"><span class="comment">  	则更新本地。</span></span><br><span class="line"><span class="comment">  	预拉取只有用户首次进入小程序才会进行，并不是每次进入小程序都会进行的。</span></span><br><span class="line"><span class="comment"> 	那么此时该接口的请求，是为了及时更新数据。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   	有&lt;数据预拉取&gt;机制，同样有&lt;数据周期性更新&gt;，但是它是每隔12小时进行一次，并不及时。</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">list</span>[<span class="number">0</span>].<span class="property">spus</span>) !== <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">shopGoods</span>))&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setLocalShopGoods</span>(res.<span class="property">list</span>[<span class="number">0</span>].<span class="property">spus</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>想了一下，还是需要12h周期性更新的。<br>否则只在请求中更新数据，虽然有了更新机制，但是此时并没有做到减少用户等待时间了。</p>
<p>&lt;微信开发者工具&gt;在头部&lt;工具&gt;拉取更新数据（调试）。</p>
</li>
</ol>
</blockquote>
</li>
</ul>
<h6 id="Friday-17"><a href="#Friday-17" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
此时我请求了一个接口，拿到部分数据，渲染为一个列表，列表每一项都有补充信息需要额外请求接口，在逻辑上，我需要等到列表项所有请求完成，再进行后续操作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.把列表项的每个请求（封装）都返回为Promise，请求成功时resolve，失败reject。</span></span><br><span class="line"><span class="comment">// 2.将每个Promise push进一个空数组promisesList。</span></span><br><span class="line"><span class="comment">// 3.Promise.all(promisesList) 等待所有请求完成，then中执行后续操作。</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><input checked disabled type="checkbox"> 
统一数据字段在前端的实现，比如说我封装了一个商品卡片组件，在搜索、购物车、订单都有使用，尽管在&lt;商品详情&gt;中获取到所需字段，但除此之外的请求的接口中并没有给我返回这些字段。</p>
<p>又或者某字段在不同接口中的层级不一样，所以要通过 || 在标签内判断展示。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
本地存储与更新机制。</p>
<p>想到的蠢一点的方法就是前面说的JSON.stringify比较云端和本地的数据。</p>
<p>或者根据updateTime去判断（未实现）。</p>
</li>
</ul>
<h4 id="第二十二周（4-x2F-17-4-x2F-21）"><a href="#第二十二周（4-x2F-17-4-x2F-21）" class="headerlink" title="第二十二周（4&#x2F;17 - 4&#x2F;21）"></a>第二十二周（4&#x2F;17 - 4&#x2F;21）</h4><h6 id="Monday-20"><a href="#Monday-20" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><input checked disabled type="checkbox"> 请假搞毕设去了。</li>
</ul>
<h6 id="Tuesday-20"><a href="#Tuesday-20" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
在&lt;支付页&gt;中，首先要选择收货地址，这也是一个更新到后端的接口。但用户选择收货地址后返回当前&lt;支付页&gt;，需要重新调用&lt;获取订单信息&gt;接口，更新当前订单的用户收货地址，否则还是用原来的收货地址但实际已经改变，请求不到结果。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
收货地址的增、删Bug修复</p>
<p>出现的问题是，如果我在另外的设备添加了地址，不会同步到本机；已经删除的云端地址，本地却还在；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 成功请求列表后</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">userAddress</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">localAddr</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 未在云端找到本地对应的地址，则删除本地</span></span><br><span class="line">    <span class="keyword">const</span> isExistLocal = res.<span class="title function_">find</span>(<span class="function"><span class="params">item2</span> =&gt;</span> item2.<span class="property">addrId</span>==localAddr.<span class="property">addrId</span>)</span><br><span class="line">    <span class="comment">// Vuex根据id删除地址</span></span><br><span class="line">    <span class="keyword">if</span>(!isExistLocal) <span class="variable language_">this</span>.<span class="title function_">deleteAddrIdAddress</span>(localAddr.<span class="property">addrId</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">res.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item ,index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> isLocalExist = <span class="variable language_">this</span>.<span class="property">userAddress</span>.<span class="title function_">find</span>(<span class="function"><span class="params">local</span> =&gt;</span> local.<span class="property">addrId</span> == item.<span class="property">addrId</span>)</span><br><span class="line">    <span class="keyword">if</span>(!isLocalExist)&#123;</span><br><span class="line">        <span class="comment">// 未在本地找到云端对应地址，则添加本地</span></span><br><span class="line">        <span class="keyword">const</span> userAddress = &#123;...&#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">updateUserAddress</span>(userAddress)			<span class="comment">// Vuex添加</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 云端在本地找到对应地址，如果云端更新，则更新本地</span></span><br><span class="line">        <span class="keyword">const</span> resStr = item.<span class="property">consignee</span> + item.<span class="property">mobile</span> + item.<span class="property">city</span> + item.<span class="property">area</span></span><br><span class="line">        <span class="keyword">const</span> localStr = isLocalExist.<span class="property">consignee</span> + isLocalExist.<span class="property">mobile</span> + isLocalExist.<span class="property">city</span> + isLocalExist.<span class="property">area</span></span><br><span class="line">        <span class="keyword">if</span>(localStr !== resStr)&#123;</span><br><span class="line">            <span class="keyword">const</span> userAddress = &#123;...&#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">changeUserAddress</span>(userAddress)		<span class="comment">// Vuex更新</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="Wednesday-17"><a href="#Wednesday-17" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
请求列表数据会得到它的总页数pages，每一次触底都会将本地的page自增去请求，在onReachBottom生命周期中的请求逻辑前判断，如果本地的page大于或等于总页数pages，即代表请求到最后一页数据，return、不再请求。</p>
<p>另外在page.json对应页面中可以配置onReachBottomDistance，表示距离底部的触发距离，提前加载数据。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
写后台管理的小程序信息配置，比如热搜、轮播图，和商品上架流程的文档。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
热搜词条跳转商品详情。</p>
<p>获取热搜列表后，通过热搜的名字调用&lt;搜索&gt;接口，拿到其中它的spuId信息，之后就和此前说的调用&lt;获取spu详情信息&gt;接口一致了。</p>
<p>为了实现这一点，只需要在后台配置热搜时将词条和商品名字一一对应就行了。</p>
<p>之前一直搁置这个功能的点在于：的确没有一个接口符合热搜词条直接跳转商品详情的需求。当时也想过从&lt;搜索&gt;接口出发去获取spuId信息，但热搜词条并没有符合请求参数的分类Id等。</p>
</li>
</ul>
<h6 id="Thursday-19"><a href="#Thursday-19" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
完善周二所说的&lt;订单页&gt;重新获取订单信息的逻辑，考虑非直接从&lt;商品详情&gt;进入，而是&lt;购物车结算&gt;的情况。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
&lt;邮费&gt;接口，根据用户默认地址和发货地的距离返回邮费，业务在后端实现。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
已经下架的商品，用户之前添加的，此时还留在购物车里，这是缓存导致的原因。</p>
<p>判断本地的数据在不在云端存在（id），不在则删除本地，步骤和周二所说一致。</p>
</li>
</ul>
<h6 id="Friday-18"><a href="#Friday-18" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
收货地址问题。</p>
<p>为了方便，我给用户提供了一个快速定位当前位置的Api，以及手动填写两种方式。</p>
<p>虽然后端的确是拿到了这个位置信息，但是相对于&lt;邮费&gt;接口而言，无法识别该位置。</p>
<p>首先说下合理做法：</p>
<ol>
<li>使用三级联动选择省、市、区。</li>
<li>用户选择到区级时，此时成功获得到areaId、cityId，也就是说前端要将这两个字段返回后端，后端根据这两个字段计算发货地到目的地之间的距离，从而得出运费（业务会给一个运费模板，即判断地区邮费的不同）。</li>
</ol>
<p>再说回来：</p>
<p>​	我的那种做法，没有将areaId和cityId返回后端，只是返回了一串地址信息字符串，如：“湖南省长沙市…”，但对于后端而言这并不是一个位置信息，即他无法识别这个字符串是在什么位置，因此无法判断距离与运费。</p>
<p>​	我尝试不使用三级联动，希望能获取到用户填写的收货地址的经纬度，但看了一下接口，只找到一个获取用户当前经纬度的Api，如果对于用户非当前位置的收货地址，是无法实现业务的。</p>
</li>
</ul>
<h4 id="第二十三周（4-x2F-23-4-x2F-28）"><a href="#第二十三周（4-x2F-23-4-x2F-28）" class="headerlink" title="第二十三周（4&#x2F;23 - 4&#x2F;28）"></a>第二十三周（4&#x2F;23 - 4&#x2F;28）</h4><h6 id="Weekday"><a href="#Weekday" class="headerlink" title="Weekday"></a><em>Weekday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
三级联动。</p>
<p>找了些组件，都是将省、市、区数据作为整体渲染的。</p>
<p>但后端的接口只返回省、市数据，选择市级后，再请求区级数据。如果我此时请求到的区数据、添加到对应的市数据的子节点上，页面不会立刻刷新，重新打开才有效果。</p>
<p>实现：</p>
<p>三个scroll-view组件横向排列，后一个scroll-view组件基于前一个是否有数据渲染进行v-if判断，从而控制显隐。点击市级从而请求区级数据，push进区级scroll-view渲染的数组字段中去。</p>
<p>另外就是重新选择一级，就要清除二级、三级数据。依次类推。</p>
</li>
</ul>
<h6 id="Monday-21"><a href="#Monday-21" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
处理从购物车进入的&lt;支付详情页&gt;、重新选择收货地址后多个商品变为一个的问题。</p>
<p>这里要重新调用购物车&lt;结算，生成订单信息&gt;接口，若无商品信息（spuId和skuId），则是生成购物车的订单信息；若有，就是对单个商品生成订单信息。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
处理重复选择收货地址返回支付导致请求失效。</p>
<p>在选择收货地址后，返回重新生成订单，那么订单中订单参数就不是原来的了。此时再去选择收货地址、返回，找不到原来的字段，也就请求不到数据了。</p>
<p>这里需要做的就是通过或门，给请求中的字段添加新的可能（改变后的字段）。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
判断从购物车进入&lt;支付页&gt;。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pages = <span class="title function_">getCurrentPages</span>()</span><br><span class="line"><span class="comment">// pages[pages.length-1]表示当前页面</span></span><br><span class="line"><span class="keyword">if</span>(pages[pages.<span class="property">length</span>-<span class="number">2</span>].<span class="property">route</span> == <span class="string">&quot;pages/cart/cart&quot;</span>) ...</span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="Tuesday-21"><a href="#Tuesday-21" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
加购失败处理。</p>
<p>之前在&lt;商品页&gt;的加购逻辑分为：</p>
<ol>
<li>购物车已有，则增加购物车已有商品的数量（请求修改后端与本地修改）。</li>
<li>购物车没有，则添加进购物车。</li>
</ol>
<p>但在体验版上出现了个请求失败的错误：用户首次进入体验版，经未登录弹框提示、登录后回到&lt;商品页&gt;，点击加购，结果请求不到结果，提示错误信息。</p>
<p>这是因为以上判断购物车已有或者没有的逻辑，是基于本地的购物车数据来的。如果用户首次登录后并没有来到&lt;购物车&gt;页面，也即没有请求购物车数据，没有添加到本地，那此时本地的购物车数据就是空，点击&lt;加购&gt;进行的逻辑就是&lt;添加进购物车&gt;。</p>
<p>实际上，如果该用户的后端购物车数据是有的、不为空，原本应该进行修改购物车数量的请求，但最终却进行了添加请求，那么对于这个商品就会在后端报逻辑错误。</p>
<p>处理方式：</p>
<p>在加购的&lt;添加或修改&gt;请求之前，根据本地是否有购物车数据，没有就请求购物车数据。接着用Promise或async的方式同步处理，这是为了确保拿到了数据再进行接下来的操作，因为请求是异步的。</p>
</li>
</ul>
<h6 id="Wednesday-18"><a href="#Wednesday-18" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
微信开发文档提供的xr-frame框架，可以用来实现AR效果，将3D模型渲染在小程序前端上。</p>
<p>底层应该还是Three.js。</p>
<p>现在这个小程序第一阶段基本上算结束了，下一个项目跨度有点大，技术设计到AR方面，比如：照片生成模型、捏脸、换装、结合3D场景实现收纳功能等，但我对这些没有半点经验，所以现在只是技术探索阶段。</p>
<p>对于其中的某些技术点，比如照片生成模型，这一部分可能要采用第三方云服务或某些APP得到模型，其次的模型渲染才是前端注重要做的。</p>
</li>
</ul>
<h6 id="Thursday-Friday"><a href="#Thursday-Friday" class="headerlink" title="Thursday - Friday"></a><em>Thursday - Friday</em></h6><ul>
<li><input checked disabled type="checkbox"> 一些琐事。</li>
</ul>
<h4 id="第二十四周（5-x2F-4-5-x2F-6）"><a href="#第二十四周（5-x2F-4-5-x2F-6）" class="headerlink" title="第二十四周（5&#x2F;4 - 5&#x2F;6）"></a>第二十四周（5&#x2F;4 - 5&#x2F;6）</h4><h6 id="Thursday-20"><a href="#Thursday-20" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
3D扫描建模的探索。</p>
<p>暂时借助于IOS上的Qlone软件，只要对物体进行视频扫描，它就能给出一个模型文件（应用于Three.js在前端的渲染）。不过软件似乎并不能做到精致的建模，可以考虑3D扫描仪之类。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
Three.js的学习：创建场景。</p>
</li>
</ul>
<h6 id="Friday-19"><a href="#Friday-19" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
Three.js的学习：载入3D模型。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
H5。</p>
<p>之前对这个理论没有概念，以为是HTML5新版本多出的那些标签。</p>
<p>H5主要用于营销，例如领取优惠券、活动展示等，它增强了网页编写对移动设备的支持。</p>
<p>一个H5链接是可以在微信中打开并进行操作的，比如常见的链接分享，同时，也可以放置在微信公众号的tab中，且并不局限于微信平台。</p>
</li>
</ul>
<h6 id="Saturday"><a href="#Saturday" class="headerlink" title="Saturday"></a><em>Saturday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
尝试用Bootstrap的响应式去做移动端H5页面，但是我的开发效率不是太好，要补充一下这方面的知识：</p>
<p>一是适配问题，在各个设备机型上都能使页面不失真，大致要用到rem和viewport。</p>
<p>二是如何去做移动端H5的开发，虽然HbuilderX中可以创建H5的项目，但是我看不太懂目录结构等，无从下手。</p>
</li>
</ul>
<h4 id="第二十五周（5-x2F-8-5-x2F-12）"><a href="#第二十五周（5-x2F-8-5-x2F-12）" class="headerlink" title="第二十五周（5&#x2F;8 - 5&#x2F;12）"></a>第二十五周（5&#x2F;8 - 5&#x2F;12）</h4><h6 id="Monday-22"><a href="#Monday-22" class="headerlink" title="Monday"></a><em><strong>Monday</strong></em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
css命名规范BEM。</p>
<p>移动端网页开发还是基于一个html，引入css、js文件。一个页面就是一个html（单页面应用）。</p>
<p>如果引入多个css文件——这些css文件可能是由负责不同模块页面的人写出来的，即此时某些样式可能会造成覆盖。</p>
<p>BEM就是解决命名冲突的。(Block块, Element子元素, Modifier修饰符)</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.form</span> &#123; &#125;</span><br><span class="line"><span class="selector-class">.form--theme-xmas</span> &#123; &#125;</span><br><span class="line"><span class="selector-class">.form--simple</span> &#123; &#125;</span><br><span class="line"><span class="selector-class">.form__input</span> &#123; &#125;</span><br><span class="line"><span class="selector-class">.form__submit</span> &#123; &#125;</span><br><span class="line"><span class="selector-class">.form__submit--disabled</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//对应的HTML结构如下：</span></span><br><span class="line">&lt;<span class="selector-tag">form</span> class=&quot;<span class="selector-tag">form</span> <span class="selector-tag">form</span><span class="attr">--theme-xmas</span> <span class="selector-tag">form</span><span class="attr">--simple</span>&quot;&gt;</span><br><span class="line">  &lt;<span class="selector-tag">input</span> class=&quot;form__input&quot; type=&quot;text&quot; /&gt;</span><br><span class="line">  &lt;<span class="selector-tag">input</span></span><br><span class="line">    class=&quot;form__submit form__submit<span class="attr">--disabled</span>&quot;</span><br><span class="line">    type=&quot;submit&quot; /&gt;</span><br><span class="line">&lt;/<span class="selector-tag">form</span>&gt;</span><br></pre></td></tr></table></figure>

<p>__ 双下划线：连接块和块的子元素。</p>
<p>–双中划线：连接修饰符</p>
</li>
<li><p><input checked disabled type="checkbox"> 
LESS预处理器的混入用法。</p>
<p>之前页面中有很多Flex布局，都是重复写的，太繁琐了。</p>
<p>LESS的混入就相当于Js中的函数。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 弹性盒子</span></span><br><span class="line"><span class="selector-class">.flex-box</span>(<span class="variable">@direction</span>:row, <span class="variable">@justifyContent</span>: center, <span class="variable">@alignItems</span>: center)&#123;</span><br><span class="line">    <span class="attribute">display</span>:flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: <span class="variable">@direction</span>;</span><br><span class="line">    <span class="attribute">justify-content</span>: <span class="variable">@justifyContent</span>;</span><br><span class="line">    <span class="attribute">align-items</span>: <span class="variable">@alignItems</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 某个元素选择器使用</span></span><br><span class="line"><span class="selector-class">.groupBuy-section-brand</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="selector-class">.flex-box</span>(column, center, start);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><input checked disabled type="checkbox"> 
vw和rem适配。</p>
<p>以750设计稿为例。（LESS写法）</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@designWidth:</span> <span class="number">750</span>;      <span class="comment">// 750设计稿宽度</span></span><br><span class="line"><span class="variable">@designHeight:</span> <span class="number">667</span>*<span class="number">2</span>;  </span><br><span class="line"></span><br><span class="line"><span class="selector-class">.vw</span>(<span class="variable">@px</span>)&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="variable">@px</span> / <span class="variable">@designWidth</span> * <span class="number">100vw</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相应元素就使用.vw设置宽度。1vw就是屏幕1%宽度</span></span><br></pre></td></tr></table></figure>

<p>字体的相对大小设置，就是给根元素html或body设置默认字体大小16px，之后使用rem设置相应元素的字体大小，比如1rem就相当于16px。</p>
</li>
</ul>
<h6 id="Tuesday-22"><a href="#Tuesday-22" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><input disabled type="checkbox"> 对于单一设备的字体而言，通过rem可以获得不错的显示效果，但是一旦切换设备，字体就会过大&#x2F;过小，并没有做到适配。</li>
<li><input checked disabled type="checkbox"> 用原生的html把首页搭建出来，但是有个问题，如果后面涉及登录这种数据操作，用原生的dom去更新数据似乎有点麻烦，数据获取和存储方面倒是同样通过请求（ajax&#x2F;axios）和本地存储去操作。</li>
</ul>
<h6 id="Wednesday-19"><a href="#Wednesday-19" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
所以还是用Vue框架去写，写久了uniapp，Vue的路由vue-router忘了差不多。不同于uniapp的路由跳转是直接通过navigateTo等方法直接跳转路径并携带参数，Vue项目的路由跳转是通过在页面中放置：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>监听路由的变化并跳转相应页面。路由的配置（创建router.js）要借助vue-router插件，并且路由的传参也在此时完成，其他的就还有路由守卫：进入路由之前、离开路由之前触发的函数。</p>
<p>大概步骤：</p>
<ol>
<li><p>创建router.js，导入vue-router插件（命名为Router）并Vue.use()。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建路由实例</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;</span><br><span class="line">    <span class="attr">routes</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;Home&quot;</span>,</span><br><span class="line">            <span class="comment">// 懒加载组件</span></span><br><span class="line">            <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;@/views/HomePage/index.vue&quot;</span>),</span><br><span class="line">            <span class="attr">meta</span>:&#123;</span><br><span class="line">            	<span class="comment">// 是否需要验证，自定义字段</span></span><br><span class="line">            	<span class="attr">isAuth</span>: <span class="literal">false</span></span><br><span class="line">        	&#125;,</span><br><span class="line">            <span class="comment">// 传参</span></span><br><span class="line">            <span class="comment">// query:&#123;&#125;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line">        </span><br><span class="line"><span class="comment">// 路由的全局前置守卫</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(to.<span class="property">meta</span>.<span class="property">isAuth</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">        <span class="keyword">if</span>(token)&#123;</span><br><span class="line">            <span class="comment">// 放行</span></span><br><span class="line">            <span class="title function_">next</span>()</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;没有权限，请先登录&quot;</span>);</span><br><span class="line">            <span class="comment">// 中止跳转</span></span><br><span class="line">            <span class="comment">// return false	</span></span><br><span class="line">            <span class="title function_">next</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后导出路由，并挂载到main.js的Vue实例上。</p>
</li>
</ol>
</li>
</ul>
<h6 id="Thursday-21"><a href="#Thursday-21" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
引入VantUI库开发订单页、收货地址，引入步骤需要时看官方。</p>
<p>需要注意的是，导入vant组件时直接在main.js中use，这种全局引入可以在每个页面或组件中直接使用vant组件，另一种就是在页面或组件内单独导入并use。</p>
</li>
</ul>
<h6 id="Friday-20"><a href="#Friday-20" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
之前写uniapp小程序时，官方组件的样式不是很符合需要，就直接改了源码的样式，但这样做之后再引用这个组件，如果样式的需要又变动了，就又需要改。但又会影响到之前使用组件的那个页面。</p>
<p>VantUI支持自定义主题，大概原理就是用自己的样式文件覆盖原本的，或许可以支持单独页面或组件的覆盖，而不影响到全局。</p>
</li>
</ul>
<h4 id="第二十六周（5-x2F-15-5-x2F-19）"><a href="#第二十六周（5-x2F-15-5-x2F-19）" class="headerlink" title="第二十六周（5&#x2F;15 - 5&#x2F;19）"></a>第二十六周（5&#x2F;15 - 5&#x2F;19）</h4><h6 id="Monday-23"><a href="#Monday-23" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
团购H5用户活动图。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
了解H5链接怎么通过微信登录，分为在微信环境内打开，和移动端浏览器内打开两种环境。</p>
<ol>
<li><p>首先在全局前置路由守卫中判断，即将前往的路由（页面）是否需要身份验证，和小程序基本一致，没有access_token就申请登录。</p>
<p>不过，微信H5是通过访问一个官方链接获取登录的code（类似小程序中登录code）。通过配置微信公众号的appId、重定向链接地址等信息，用户授权同意，就重定向到指定的链接地址，并携带上code参数。然后从链接地址中提取出code，并传给后端、换取access_token等信息。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过 window.location.href 重置访问的链接地址</span></span><br><span class="line"><span class="comment">// 以下这个链接，微信开发文档（公众号）中有，并有教程</span></span><br><span class="line"><span class="keyword">const</span> wx_login_url = <span class="string">`https://open.weixin.qq.com/connect/oauth2/authorize?appid=<span class="subst">$&#123;wxAppId&#125;</span>&amp;redirect_uri=<span class="subst">$&#123;redirect_url&#125;</span>&amp;response_type=code&amp;scope=<span class="subst">$&#123;scope&#125;</span>&amp;state=STATE#wechat_redirect`</span></span><br></pre></td></tr></table></figure>

<img src="Users\16236\AppData\Roaming\Typora\typora-user-images\image-20230516185131712.png" alt="image-20230516185131712" style="zoom:25%;">

</li>
<li><p>第二种非微信浏览器通过微信授权的方式也是访问一个官方链接拿去code，不过还没验证。</p>
</li>
</ol>
</li>
</ul>
<h6 id="Tuesday-23"><a href="#Tuesday-23" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
用户点击分享，此时只有一个链接地址，但官方提供了一些接口实现自定义标题、描述、图片，并且即使在H5（微信环境）中，也是可以直接调用微信支付的。非微信环境可能就是生成支付二维码。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
当运行Vue项目时，有一个本机访问地址和局域网访问地址。打开微信开发者工具的公众号项目，可以将本机访问地址粘贴在开发者工具的地址链接栏，这样就相当于运行在微信环境了。同时，局域网访问地址也可以在手机打开（微信、浏览器等等）。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
昨天说的那个通过提取链接中的code信息，从而进一步换取access_token，有一个问题就是通过window.location.href重置链接地址后，跳转前后的两个页面是不相关的。</p>
<p>也就是说，即便我在前一个页面再怎么尝试去获取链接中的code信息，在第二个页面中这一段Js代码都无效、因为都不存在。</p>
<p>最后把项目打包生成的正式环境压缩文件，放在服务器上后，才终于明白，第二个页面并不是微信提供的跳转的链接（这时我没办法用Js操作它的地址链接），而是用户同意授权后重定向的服务器页面（我可以在它的生命周期或路由中操作）。</p>
</li>
</ul>
<h6 id="Wednesday-20"><a href="#Wednesday-20" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
又加了一个需求：供应链H5链接。</p>
<p>这个和之前的团购H5链接，并非两个不相干的部分。</p>
<blockquote>
<p>供应链H5链接提供给供应商，填写他们的个人信息，以及所有的商品信息。</p>
<p>然后，由商家从不同供应商中的商品信息列表中选品、上架。用户购买后（此时付款金额流向商家），由供应商直接发往买家用户。</p>
<p>买家确认收货（保证商品质量无误后），再由商家付款给供应商。</p>
</blockquote>
</li>
</ul>
<h6 id="Thursday-22"><a href="#Thursday-22" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
解决链接在微信授权后页面重定向的问题。</p>
<p>对重定向地址进行浏览器编码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PayOrder就是Vue项目的路由名称，由此可以跳转到指定页面</span></span><br><span class="line"><span class="comment">// 一开始我是用encodeURI进行编码，但它不能对“#”识别、编码，所以我在重定向页面时一直报错：路径参数错误</span></span><br><span class="line"><span class="keyword">const</span> redirect_url = <span class="built_in">encodeURIComponent</span>(<span class="string">&quot;https://abc.something.com/dist/#/PayOrder&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>最后没有用全局前置路由，而是用了点击事件去触发授权跳转。</p>
</li>
</ul>
<h6 id="Friday-21"><a href="#Friday-21" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
补充供应链H5的概念：</p>
<blockquote>
<p>供应商可以分享链接给他的“用户”，表示授权，由此供应商的用户可以看到供应商的所有商品列表，同时也可以主动申请权限。</p>
<p>而我们（平台）收集所有供应商的个人信息和商品列表信息。</p>
</blockquote>
</li>
<li><p><input checked disabled type="checkbox"> 
供应链H5商品信息收集模块的增删改查。</p>
</li>
</ul>
<h4 id="第二十七周（5-x2F-22-5-x2F-26）"><a href="#第二十七周（5-x2F-22-5-x2F-26）" class="headerlink" title="第二十七周（5&#x2F;22 - 5&#x2F;26）"></a>第二十七周（5&#x2F;22 - 5&#x2F;26）</h4><h6 id="Monday-24"><a href="#Monday-24" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
柔性供应链的日期筛选功能。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
调试了一下小程序跳转H5，利用web-view标签可以实现，并且在跳转时可以携带上用户在小程序中的登录access_token，有这个验证，在H5中大多数接口是能调用的（因为这些基本上都是我们自有的平台接口），除了最终的支付。</p>
<p>在小程序支付中，最终的收银台支付其实是调用wx.requestPayment，但H5中（浏览器）是没有这个wx对象的，所以H5是没办法借助小程序直接调用微信支付。</p>
<p>能接入H5支付最好，但我从网上看了一个解决方案，就是支付时从H5跳转回小程序，支付成功或失败后再跳转回H5（未验证）。</p>
</li>
</ul>
<h6 id="Tuesday-24"><a href="#Tuesday-24" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
分销。</p>
<p>平台会给合作方生成专属的二维码，本质上还是一个链接，携带有合作方Id、优惠券Id以及商品Id，跳转到小程序对应页面。</p>
<p>也就是说，用户如果通过扫码的方式进入领券页面，进行注册，就将当前用户Id和合作方Id，这一步是为了计算合作方的拉新数。</p>
<p>至于优惠券Id和商品Id，是为了标识当前派发的优惠券和对应的商品。</p>
<p>后续订单的成交时，也会绑定合作方Id，记录合作方拉新的成交数。</p>
</li>
</ul>
<h6 id="Wednesday-21"><a href="#Wednesday-21" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
把领券的这个页面做出来了，就是简单的优惠券、领取按钮、对应商品以及说明。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
柔性供应链工具中，商品信息提交中涉及到了图片，而当前的设计是用户可能并不一定立即提交，需要暂存到本地。</p>
<p>利用Vant组件的upload上传组件，可以获得图片的base64格式，能把它保存到本地，进行渲染。</p>
<p>但问题就是如果图片大小过大，在首页的商品信息列表中是可以左滑删除的，这时就会有页面的重排重绘，效果就是十分卡顿，甚至浏览器的性能检测器都显示&lt;CPU使用率&gt;超过80%。</p>
<p>所以做了图片的压缩，一个是<image-conversion>插件，能够直接调用方法对组件获得的File对象进行压缩，但是我的页面没法对这个File对象渲染、显示出来（没用这个）；一个就是利用canvas去压缩图片，最终的确是能压缩成功，但我是封装成一个函数工具，return出来确实undefined（暂时搁置了）。</image-conversion></p>
</li>
</ul>
<h6 id="Thursday-23"><a href="#Thursday-23" class="headerlink" title="Thursday"></a>Thursday</h6><ul>
<li><p><input checked disabled type="checkbox"> 
二维码链接的设置。</p>
<p>在&lt;微信公众平台&gt;，&lt;开发管理&gt;下&lt;开发设置&gt;选项，可以配置&lt;扫普通链接二维码打开小程序&gt;，然后把设置的域名（不带小程序路径）传给后端，由后端创建相应的二维码，携带的参数就通过?拼接在域名链接后。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
在后台管理系统中，新增了一个模块，也就是两个页面，一个记录合作方的信息，一个就是筛选合作方列表、优惠券列表（制券时能够对应商品），拿到它们的参数信息，最终生成二维码。两者都做了表格列表的显示。</p>
</li>
</ul>
<h6 id="Friday-22"><a href="#Friday-22" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
后台二维码生成的配置参数的页面、合作方信息录入页面，以及优惠券配置时指定商品等接口的联调。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
在二维码链接跳转小程序时拼接参数的&amp;会被编码为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = “&amp;” + <span class="string">&quot;amp;&quot;</span>		<span class="comment">// 写一块就自动变成原来&amp;形式了。</span></span><br></pre></td></tr></table></figure>

<p>解决办法就是后端改一下字段，前端分别把链接路径和参数传过去，后端拼接；或者后端直接用正则把编码后的形式替换回去。</p>
</li>
</ul>
<h4 id="第二十八周（5-x2F-29-6-x2F-2）"><a href="#第二十八周（5-x2F-29-6-x2F-2）" class="headerlink" title="第二十八周（5&#x2F;29 - 6&#x2F;2）"></a>第二十八周（5&#x2F;29 - 6&#x2F;2）</h4><h6 id="Monday-25"><a href="#Monday-25" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
Postman调试。</p>
<p>之前很少用到Postman，也只是测试后端的接口能不能调用。</p>
<p>原来在微信开发文档上的一些服务端API，也能通过Postman直接调用，就不用每次都需要等后端处理了。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
微信开发者工具二维码编译。</p>
<p>通过Postman调用微信API生成二维码，这个二维码上是包含跳转小程序的页面路径，以及携带的参数。通过&lt;二维码编译&gt;，每次开发调试时都能有参数可以使用，就不用把代码提交审核、正式发布了。（这个二维码是需要小程序发布，才能正确访问的）</p>
</li>
</ul>
<h6 id="Tuesday-25"><a href="#Tuesday-25" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
分销实现逻辑。</p>
<p>用户扫码进入领券页面时，在页面的onload生命周期中提取参数、即合作方Id，存储到本地。</p>
<p>对于用户退出小程序，就在App.vue的onHide生命周期中，清除本地的合作方Id。</p>
<p>这样实现的效果是，只要用户是通过二维码进入并进行的消费行为（订单），都会记录在相应的二维码合作方上。当下次扫码，消费行为仍然会记录在下一个合作方上。有点类似session会话。</p>
<p>通过合作方Id的有无就可以判断是否要进行订单对合作方的绑定（接口），否，则表示正常支付。</p>
<p>不过这样有个问题：</p>
<p>已注册并绑定合作方Id的用户，正常进入小程序而不是扫码，由于未存储本地合作方Id，它的成交如何记录到合作方Id上呢？</p>
<p>这个由后端去做。</p>
<p>总体来说，这个业务就是用户可以不断扫码、领不同合作方的券，每次扫码的消费行为都会记录到相应的二维码的合作方上。而对于正常消费行为，则记录到注册时绑定的合作方上。</p>
</li>
</ul>
<h6 id="Wednesday-22"><a href="#Wednesday-22" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
UI修改。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
另一个前端写了个订单取消支付后，会有个30分钟倒计时提醒的功能。</p>
<p>她用到了定时器setInterval，通过封装方法，并根据订单创建时间的时间戳，计算出剩余支付时间。</p>
<p>不过，由于定时器setInterval不是立即执行的，也就是说在页面渲染时，会有一段时间（定时器间隔）拿不到剩余时间。</p>
<p>解决办法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单卡片组件内生命周期，提前于mounted生命周期，也是解决有一段时间不渲染倒计时的问题</span></span><br><span class="line"><span class="attr">created</span>:&#123;</span><br><span class="line">    <span class="comment">// 在定时器前执行一次</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title class_">IntervalFn</span>()</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">timer</span> = <span class="built_in">setInterval</span>(<span class="variable language_">this</span>.<span class="property">IntervalFn</span>, <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="Thursday-24"><a href="#Thursday-24" class="headerlink" title="Thursday"></a>Thursday</h6><ul>
<li><p><input checked disabled type="checkbox"> 
Sku选择。</p>
<p>之前进入商品页时是通过spuId去查spu商品数据（包含sku数据）。</p>
<p>用DClound插件市场的sku选择组件，渲染不同的sku数据。</p>
<p>效果如下：</p>
<img src="Users\16236\AppData\Roaming\Typora\typora-user-images\image-20230601181220828.png" alt="image-20230601181220828" style="zoom: 67%;"></li>
</ul>
<h6 id="Friday-23"><a href="#Friday-23" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
openID和unionID。</p>
<p>在微信环境下，用户进入不同的小程序或公众号应用（H5）时，分别获得不同的openID。</p>
<p>对于当前应用，可以通过openID区分用户。</p>
<p>但对于不同的微信应用，比如用户A进入小程序A、小程序B、公众号A，获取到的openID都是不同的。</p>
<p>这就有一个问题，如果我们有两个产品，比如一个小程序、一个公众号H5，同一个用户进入两个入口，用openID记录的信息可能就不一样。</p>
<p>unionID则是用户在微信环境的唯一标识，无论进入小程序A、小程序B还是公众号。</p>
<p>那么在不同的应用中，就可以通过unionID获得用户同样的信息。</p>
</li>
</ul>
<h4 id="第二十九周（6-x2F-5-6-x2F-9）"><a href="#第二十九周（6-x2F-5-6-x2F-9）" class="headerlink" title="第二十九周（6&#x2F;5 - 6&#x2F;9）"></a>第二十九周（6&#x2F;5 - 6&#x2F;9）</h4><h6 id="Monday-26"><a href="#Monday-26" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
可选链操作符</p>
<p>要调用层级过深的对象的属性时，需要判断属性的前一级或前几级是否存在，否则直接调用会报错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通写法</span></span><br><span class="line">obj.<span class="property">a</span> &amp;&amp; obj.<span class="property">a</span>.<span class="property">b</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可选链操作符</span></span><br><span class="line">obj.<span class="property">a</span>?.<span class="property">b</span>?.<span class="property">c</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><input checked disabled type="checkbox"> 
多Tag选择功能，应用了Vant2的tag标签组件。</p>
<img src="Users\16236\AppData\Roaming\Typora\typora-user-images\image-20230605164002253.png" alt="image-20230605164002253" style="zoom: 67%;">

<p>对于&lt;可选择&gt;标签，其实就是定义一个数组，将内容v-for渲染上去。</p>
<p>点击可选择Tag时，相应的tag从&lt;可选择&gt;区域消失，显示在已选择区域。此时，就是定义另一个默认空数组，将点击的可选择标签的内容push进该数组，渲染&lt;已选择&gt;标签。同时删除已选择标签的数组相应的内容。</p>
<p>不过，这样做会让页面重排，所以在定义可选择数组时，格式不单单只是文字内容content，还有一个boolean值show用于v-show显示隐藏。也就是说，点击可选择标签时，将该标签的show置为false，且并不删除相应内容，虽然看上去标签消失了，但只是opacity的显示、隐藏，只会使页面重绘，优化了性能。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">FieldColumns</span> = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">content</span>: <span class="string">&quot;健身&quot;</span>,</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p><input checked disabled type="checkbox"> 
PC后台管理上架时的sku图片字段的添加，在小程序切换sku时能看到相应图片。</p>
</li>
</ul>
<h6 id="Tuesday-26"><a href="#Tuesday-26" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
微信网页授权</p>
<p><strong>步骤</strong></p>
<ol>
<li>通过微信官方链接（授权框从底部弹出），跳转到平台指定链接，此时链接中携带有用户code</li>
<li>通过code，调用微信服务端api（后端去接入，写接口暴露给我），换取用户的登录信息：openId、access_token</li>
<li>接着可以用access_token和openId去获得用户的微信信息，比如头像、昵称（微信服务端api，后端接入）</li>
<li>以上2、3点的服务端api，后端统一完成。我传code给他，他直接返回头像、昵称</li>
</ol>
<p><strong>避免重复授权、跳转平台链接</strong></p>
<p>微信网页授权的跳转链接是在页面的created生命周期中进行的，如果不加判断，再重定向到当前链接后，仍然会走生命周期中的代码操作，从而又一次跳转链接。</p>
<p>未授权链接和授权后链接中的区别是，后者链接中含有code信息，借此可以决定是否授权、重跳转。</p>
<p><strong>代码</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取链接中携带的参数</span></span><br><span class="line">    <span class="keyword">const</span> search = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span></span><br><span class="line">    <span class="keyword">if</span> (!search.<span class="title function_">includes</span>(<span class="string">&quot;code&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">// 在跳转前保存原有链接，否则微信授权重跳转链接（不带参数）会导致参数丢失</span></span><br><span class="line">        <span class="comment">// 由于前端路由是hash模式，后端拼接参数位置错误，所以使用href获取全链接</span></span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;originHref&quot;</span>, <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 挂载到Vue原型上的微信授权、跳转链接的方法</span></span><br><span class="line">        <span class="variable language_">this</span>.$toAuthUrl()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> originHref = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;originHref&quot;</span>)</span><br><span class="line">        <span class="keyword">const</span> applyId = originHref.<span class="title function_">split</span>(<span class="string">&quot;apply_id=&quot;</span>)[<span class="number">1</span>]</span><br><span class="line">        applyId &amp;&amp; apply_api.<span class="title function_">getSpreadInfo</span>(applyId)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; name, wechatAvator &#125; = res</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">spreadInfo</span>.<span class="property">name</span> = name</span><br><span class="line">            <span class="comment">// 展示在页面上</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">spreadInfo</span>.<span class="property">avatar</span> = wechatAvator</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">spreadInfo</span>.<span class="property">recommenderId</span> = applyId</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> code = search.<span class="title function_">split</span>(<span class="string">&quot;code=&quot;</span>)[<span class="number">1</span>].<span class="title function_">split</span>(<span class="string">&quot;&amp;&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">        apply_api.<span class="title function_">getWxToken</span>(code)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            	<span class="variable language_">this</span>.<span class="property">valiFormData</span>.<span class="property">wechatAvator</span> = res.<span class="property">headimgurl</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><strong>说明</strong></p>
<p>业务设计中，后台生成的二维码（可跳转到指定页面，并携带推广者applyId，即信息）。</p>
<p>当下一个人扫这个二维码进入指定页面，可以通过所携参数applyId，获取推广者的信息（目前展示的只有头像）。</p>
<p>所以在上一部分&lt;代码&gt;else中的两个请求，一个是获取推广者的信息进行展示；一个是获取用户的微信信息（头像），在提交表单时携带上头像字段（生成他的推广二维码时，他的下一级用户就可以通过前一个请求获取、展示头像）。</p>
<p><strong>优化</strong></p>
<p>之前是在&lt;获取用户微信信息：头像&gt;这个接口成功后，再进行&lt;获取上级推广者信息&gt;的请求，但由于前者的请求时间不确定，这就导致了页面中上级推广者头像展示的过慢，并且明显地看到切换效果。</p>
<p>解决方法就是不链式调用，异步进行请求。</p>
<p>另外，也不在mounted生命周期中执行&lt;代码&gt;，不对DOM进行操作，在created生命周期请求基本无影响，优化渲染时间。</p>
<p><strong>头像渲染切换的原因</strong></p>
<p>&lt;代码&gt;中<strong>if</strong>所做，其实是跳转到微信官方链接，再跳转到我们平台指定链接，除去<strong>else</strong>中api请求损耗的时间外，<strong>if</strong>中链接跳转的时间也是存在的，所以就会看到一段时间内显示一个头像，一段时间后才切换。</p>
<p>暂时没有避免。如果放在beforeCreate生命周期执行，但就不能使用挂载到Vue原型上的方法了。</p>
<p>（纠正：beforeCreate生命周期能访问Vue原型方法上的属性方法，只是不能响应式的改变数据。）</p>
</li>
</ul>
<h6 id="Wednesday-23"><a href="#Wednesday-23" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><input checked disabled type="checkbox"> 做小程序退货的页面。</li>
</ul>
<h6 id="Thursday-25"><a href="#Thursday-25" class="headerlink" title="Thursday"></a><em>Thursday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
canvas压缩图片</p>
<p><strong>代码</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 倍率压缩 base64 图片，到指定大小附近范围（单位：KB）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params</span> &#123;<span class="type">String</span>&#125; originBase64    初始图片</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params</span> &#123;<span class="type">String</span>&#125; originType      原有图片格式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params</span> &#123;<span class="type">Number</span>&#125; compressionRatio    压缩倍率</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">String</span>&#125; compressBase64  压缩后图片</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attention</span> 压缩倍率 compressionRatio 超过 1 时默认重置为 0.92</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">compressBase64ToSize</span>(<span class="params">originBase64, originType, compressionRatio</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>)</span><br><span class="line">        <span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>)</span><br><span class="line">        <span class="keyword">const</span> image = <span class="keyword">new</span> <span class="title class_">Image</span>()</span><br><span class="line">    image.<span class="property">src</span> = originBase64</span><br><span class="line">    </span><br><span class="line">        image.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            canvas.<span class="property">width</span> = image.<span class="property">width</span></span><br><span class="line">        canvas.<span class="property">height</span> = image.<span class="property">height</span></span><br><span class="line">    </span><br><span class="line">        ctx.<span class="title function_">drawImage</span>(image, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">            <span class="comment">// canvas转base64图片：倍率压缩</span></span><br><span class="line">        <span class="keyword">const</span> canvas_compressedBase64 = canvas.<span class="title function_">toDataURL</span>(originType, compressionRatio)</span><br><span class="line">    </span><br><span class="line">            <span class="comment">// 压缩后大小</span></span><br><span class="line">            <span class="comment">// const compressedSize = Math.floor(canvas_compressedBase64.length / 1024)</span></span><br><span class="line">            <span class="comment">// console.log(&quot;compressedSize&quot;, compressedSize);</span></span><br><span class="line">            <span class="title function_">resolve</span>(canvas_compressedBase64)</span><br><span class="line">        &#125;</span><br><span class="line">        image.<span class="property">onerror</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;image onerror&quot;</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">**问题**</span><br><span class="line">  </span><br><span class="line">1. 一开始封装的这个方法，是通过**return**将压缩后的图片返回出去。但在方法调用处，获得的值却是undefined。</span><br><span class="line">  </span><br><span class="line">   这是因为：这个方法的调用是异步的，主程序调用后仍然会向下执行。</span><br><span class="line">  </span><br><span class="line">   就是说，要将其变成同步的，等待结果后再让主程序往下执行。</span><br><span class="line">  </span><br><span class="line">   所以用Promise的resolve返回结果，主程序.then处理。</span><br><span class="line">  </span><br><span class="line">  2. 传入方法的压缩倍率大于1时，canvas压缩会以0.92进行默认压缩。</span><br><span class="line">  </span><br><span class="line">     ```javascript</span><br><span class="line">     // 压缩倍率</span><br><span class="line">     const compressionRatio = designMaxSize / (file.file.size / 1024)</span><br></pre></td></tr></table></figure>

<pre><code> 压缩倍率大于1，意味着此时组件上传的图片大小（后者），已经比预设的图片期望压缩大小（前者），还要小了。
  
 此时就不进行压缩。
  
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compressionRatio &lt; <span class="number">1</span> &amp;&amp; </span><br><span class="line">  compressUtil.<span class="title function_">compressBase64ToSize</span>(file.<span class="property">content</span>, file.<span class="property">file</span>.<span class="property">type</span>, compressionRatio)</span><br><span class="line">                .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> <span class="variable language_">this</span>.<span class="property">goodsInfo</span>.<span class="property">material</span>[last].<span class="property">content</span> = res)</span><br></pre></td></tr></table></figure>
</code></pre>
<p>  <strong>其他</strong></p>
<p>  关于canvas压缩倍率大于1会使用0.92这个知识点，一开始从控制台能看到图片明显被压缩了，但问ChatGpt，很肯定地回复我：压缩倍率大于1时会按照最高图片质量返回。</p>
<p>  还是不能太相信AI。</p>
<h6 id="Friday-24"><a href="#Friday-24" class="headerlink" title="Friday"></a><em>Friday</em></h6><ul>
<li><input checked disabled type="checkbox"> 做柔性供应链页面。</li>
</ul>
<h4 id="第三十周（6-x2F-12-6-x2F-16）"><a href="#第三十周（6-x2F-12-6-x2F-16）" class="headerlink" title="第三十周（6&#x2F;12 - 6&#x2F;16）"></a>第三十周（6&#x2F;12 - 6&#x2F;16）</h4><h6 id="Monday-27"><a href="#Monday-27" class="headerlink" title="Monday"></a><em>Monday</em></h6><ul>
<li><input checked disabled type="checkbox"> 人员与商品权限的增删改查（前端）。</li>
</ul>
<h6 id="Tuesday-Wednesday"><a href="#Tuesday-Wednesday" class="headerlink" title="Tuesday - Wednesday"></a><em>Tuesday - Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
H5的权限管理</p>
<p><strong>说明</strong></p>
<p>管理员添加成员时，发起一个请求，向该成员的登录账号添加一个<code>权限数组</code>：包含了管理员勾选的权限所对应的前端路由name。</p>
<p>前端将路由分为<code>常量路由</code>：不用权限谁都可见，<code>异步路由</code>：需要权限，<code>任意路由</code>：404等页面。默认只展示常量路由。</p>
<p>成员登录，获取token同时获得权限数组，前端需要做的就是根据后端的这个权限数组，将符合条件的前端路由（异步路由）<code>筛选</code>出来，并添加到路由中（一开始路由只挂载了常量路由）。</p>
<p>异步路由是动态添加的，所以访问无权限的路由（即不匹配后端权限数组的）会是一片空白，应该重定向404或当前页。（这里防止直接输入链接地址跳转页面）</p>
<p>最后考虑<code>页面权限</code>，没有权限的页面入口，理论上通过v-if隐藏掉，通过自定义指令便捷实现。</p>
<p>而<code>接口权限</code>，就是请求接口时后端会去校验用户的权限，前端只需要请求时带上token就行。</p>
<p><strong>疑难</strong></p>
<ol>
<li>前端路由匹配后端权限数组的筛选</li>
<li>权限数组的保留与路由重新挂载</li>
<li>自定义指令控制显示隐藏的不及时性</li>
</ol>
<p><strong>解决一：异步路由筛选</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算符合后端权限的异步路由</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Array</span>&#125; asyncRoutes 异步路由</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Array</span>&#125; authorityArray 后端返回的权限数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> 过滤后的路由</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">computedAsyncRoutes</span> = (<span class="params">asyncRoutes, authorityArray</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> asyncRoutes.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 本级找到</span></span><br><span class="line">        <span class="keyword">if</span> (authorityArray.<span class="title function_">indexOf</span>(item.<span class="property">name</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (item.<span class="property">children</span>?.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> childFiltersArr = <span class="title function_">computedAsyncRoutes</span>(item.<span class="property">children</span>, authorityArray)</span><br><span class="line">                childFiltersArr.<span class="property">length</span> != <span class="number">0</span> &amp;&amp; (item.<span class="property">children</span> = childFiltersArr)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (item.<span class="property">children</span>?.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> childFiltersArr = <span class="title function_">computedAsyncRoutes</span>(item.<span class="property">children</span>, authorityArray)</span><br><span class="line">                <span class="comment">// 仅当下级找到时保留</span></span><br><span class="line">                <span class="keyword">if</span> (childFiltersArr.<span class="property">length</span> != <span class="number">0</span>) &#123;</span><br><span class="line">                    item.<span class="property">children</span> = childFiltersArr</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>filter方法对于符合条件的元素（true）的会保留。</p>
</li>
</ul>
<p><strong>解决二：路由重新挂载</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要将异步路由遍历添加</span></span><br><span class="line">router.<span class="title function_">addRoute</span>()</span><br></pre></td></tr></table></figure>

<p>通过addRoute方法将筛选后的异步路由挂载到路由上后，路由的权限控制就完成了，从效果上看：访问无权限路由就是一片空白。</p>
<p>不过，当页面重新刷新，又只剩下常量路由可以访问。</p>
<p>所以需要保留权限数组，在App.vue的生命周期created中（意味着应用加载），过滤异步路由并挂载。</p>
<p><strong>解决三：自定义指令与刷新</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册权限指令</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&quot;permission&quot;</span>,&#123;</span><br><span class="line">  <span class="attr">inserted</span>: <span class="keyword">function</span>(<span class="params">el, binding</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(binding.<span class="property">value</span>)&#123;</span><br><span class="line">      <span class="keyword">const</span> authorityArray = <span class="title class_">Vue</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">login</span>.<span class="property">authorityArray</span></span><br><span class="line">      <span class="keyword">if</span>(!authorityArray) <span class="keyword">return</span></span><br><span class="line">      <span class="comment">// 权限数组是否包含绑定值</span></span><br><span class="line">      <span class="keyword">const</span> hasPermission = authorityArray.<span class="title function_">includes</span>(binding.<span class="property">value</span>)</span><br><span class="line">      !hasPermission &amp;&amp; (el.<span class="property">parentNode</span> &amp;&amp; el.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(el))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>但有个问题是，在我切换不同权限的账号登录时，页面相应的权限页面入口并不是实时更新的，而是必须刷新页面才有效果。</p>
<p>我的解决办法是：在登录后重定向的页面的<code>组件内守卫beforeRouteEnter</code>中，强制刷新</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span>, next</span>)&#123;</span><br><span class="line">    <span class="comment">// 这种方式会导致重新请求资源：暂时用这种</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">from</span>.<span class="property">path</span> == <span class="string">&quot;/login&quot;</span>)&#123;</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="第三十一周（6-x2F-19-6-x2F-21）"><a href="#第三十一周（6-x2F-19-6-x2F-21）" class="headerlink" title="第三十一周（6&#x2F;19 - 6&#x2F;21）"></a>第三十一周（6&#x2F;19 - 6&#x2F;21）</h4><h6 id="Monday-Wednesday-1"><a href="#Monday-Wednesday-1" class="headerlink" title="Monday - Wednesday"></a>Monday - Wednesday</h6><ul>
<li><p><input checked disabled type="checkbox"> 
来了一个UI，改了七八个页面。</p>
<p>UI会把设计稿通过<code>蓝湖</code>分享给我，一般是一倍图（375px）。选择设计稿上的不同元素，就会显示相应的font-size等字体信息、背景信息、长宽信息等。不过还要考虑多屏适配问题，否则现在只有一倍屏布局效果最佳。</p>
<p>之前有不清晰地讲过，主要用vw去做适配，比如目前元素的宽占375px的比例，乘以100vw，即适配宽度。</p>
<p>不过暂时没有去做，这几天只是改页面。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
Vue项目路由history模式。</p>
<p>和hash模式不同，history模式的链接地址中不包含#，但需要后端做nginx配置。</p>
<p>前端也需要补充修改：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue.config.js配置文件</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&#x27;/mx/&#x27;</span>,   <span class="comment">// 公共路径</span></span><br><span class="line">  <span class="attr">outputDir</span>: <span class="string">&quot;mx&quot;</span>,     <span class="comment">// 打包输出目录</span></span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>主要需要做的是publicPath的设置，在hash模式下配置为相对路径，history模式需要配置为绝对路径。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
性能优化之虚拟列表。</p>
<p>v-for渲染的数据过多，长列表结构会造成资源性能的损耗，虚拟列表就是无论多少个数据，本质上只固定比如十个结构去渲染。</p>
<p>没做完。</p>
</li>
</ul>
<h4 id="第三十二周（6-x2F-26-6-x2F-30）"><a href="#第三十二周（6-x2F-26-6-x2F-30）" class="headerlink" title="第三十二周（6&#x2F;26 - 6&#x2F;30）"></a>第三十二周（6&#x2F;26 - 6&#x2F;30）</h4><h6 id="Monday-28"><a href="#Monday-28" class="headerlink" title="Monday"></a><em>Monday</em></h6><h6 id="Tuesday-27"><a href="#Tuesday-27" class="headerlink" title="Tuesday"></a><em>Tuesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
Git，分支对应功能</p>
<p><strong>场景</strong></p>
<p>今天开发时有两个任务同步进行。</p>
<p>其中一个任务开发到50%时，需要对另一个任务紧急处理。前者是UI上的翻版，从而导致了某些功能入口的缺少，后者不管进度怎样，对于用户感知到的视图是没有影响的。</p>
<p>现在我对后者紧急处理了，并且是需要上线的一个功能。如果我此时发版（体验），那么对于影响用户体验的前者是不应该保留的，但我如果用<code>git stash</code>暂存，两个开发功能都发版不了。</p>
<p>因为它两耦合了，<code>git stash</code>将上次提交后的所有更新都暂存了。</p>
<p><strong>想法</strong></p>
<p>每开发一个功能时，都应该去新建一个分支。</p>
</li>
</ul>
<h6 id="Wednesday-24"><a href="#Wednesday-24" class="headerlink" title="Wednesday"></a><em>Wednesday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
自定义导航栏抖动问题。</p>
<p><strong>场景</strong></p>
<p>手机设备状态栏、小程序右上角胶囊长宽等信息，都是调用官方api得到的。</p>
<p>如果想要自定义导航栏中左侧的返回按钮和右侧小程序自带的胶囊<code>对称</code>，以及中心显示的标题与胶囊处于同一水平线，就要动态的调用api渲染结构。</p>
<p>问题在于，长宽等信息获取是从无到有的。具体来说，对于自定义导航栏中心的标题，就会出现一个抖动的效果。</p>
<p>即使最终达到预期。</p>
<p>（具体的实现见<code>第十二周Wednesday</code>）</p>
<p><strong>解决</strong></p>
<p>在App.vue中onLaunch生命周期，调用封装的方法，去获取长宽信息，主要是：手机状态栏高度、小程序导航栏高度。</p>
<p>其次，将它们存在本地。</p>
<p>在每个页面的自定义导航栏，读取本地的高度数据，就不再重新调用api获取。</p>
</li>
<li><p><input checked disabled type="checkbox"> 
小程序长按保存图片。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 长按保存图片</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params</span> &#123;<span class="type">String</span>&#125; imgPath 云图片地址、本地图片地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">longpressSaveImg</span>(<span class="params">imgPath</span>) &#123;</span><br><span class="line">	<span class="title function_">p1</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_">p2</span>(imgPath)</span><br><span class="line">	&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">		<span class="title function_">p3</span>(res)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 弹出选项卡</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">p1</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">		wx.<span class="title function_">showActionSheet</span>(&#123;</span><br><span class="line">			<span class="attr">itemList</span>: [<span class="string">&quot;保存到相册&quot;</span>],</span><br><span class="line">			<span class="title function_">success</span>(<span class="params"></span>) &#123;</span><br><span class="line">				<span class="title function_">resolve</span>()</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取图片的本地文件地址</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">p2</span>(<span class="params">imgPath</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">		wx.<span class="title function_">getImageInfo</span>(&#123;</span><br><span class="line">			<span class="attr">src</span>: imgPath,</span><br><span class="line">			<span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">				<span class="title function_">resolve</span>(res.<span class="property">path</span>)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">p3</span>(<span class="params">filePath</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">		wx.<span class="title function_">saveImageToPhotosAlbum</span>(&#123;</span><br><span class="line">			filePath,</span><br><span class="line">			<span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">				uni.$showMsg(<span class="string">&quot;保存成功&quot;</span>)</span><br><span class="line">				<span class="title function_">resolve</span>()</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> longpressSaveImg</span><br></pre></td></tr></table></figure>

<h6 id="Thursday-Friday-1"><a href="#Thursday-Friday-1" class="headerlink" title="Thursday - Friday"></a><em>Thursday - Friday</em></h6></li>
</ul>
<h4 id="第三十三周（7-x2F-3-7-x2F-7）"><a href="#第三十三周（7-x2F-3-7-x2F-7）" class="headerlink" title="第三十三周（7&#x2F;3 - 7&#x2F;7）"></a>第三十三周（7&#x2F;3 - 7&#x2F;7）</h4><h6 id="Monday-Friday"><a href="#Monday-Friday" class="headerlink" title="Monday - Friday"></a><em>Monday - Friday</em></h6><ul>
<li><p><input checked disabled type="checkbox"> 
私享价（vip价）</p>
<p><strong>业务场景</strong></p>
<p>对于<code>普通用户</code>，他购买的商品是正常价。</p>
<p>对于<code>会员</code>，分为v1和v2两种会员，享受的是优惠价。</p>
<p><strong>前端需求1与实现</strong></p>
<p>需求：不同用户所得到的价格不同。</p>
<p>实现：</p>
<p>之前提过一个H5的项目：用户提交表单信息，提交申请会员的申请，其中有个字段就是微信绑定的手机号。</p>
<p>那么，微信小程序手机号授权登录时，能通过手机号拿到H5项目中相关信息：是否已是会员。</p>
<p>在Vuex中定义一个getter：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * 是否能看到私享价的权限，以及是否能以私享价购买</span></span><br><span class="line"><span class="comment"> * 0-乐享会员，1-乐享会员Pro, 2-漫享会员</span></span><br><span class="line"><span class="comment"> * @return false 表示该用户看不到vipPrice</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">hasPrivatePriceAuth</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(state.<span class="property">vip_info</span> == <span class="literal">null</span> || !<span class="title class_">Object</span>.<span class="title function_">keys</span>(state.<span class="property">vip_info</span>).<span class="property">length</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">let</span> auth = state.<span class="property">vip_info</span>?.<span class="property">userType</span>?.<span class="title function_">includes</span>(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> !auth</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>那么对于商城中的商品价格，就根据这个字段v-if好了。</p>
<p>（现在无论是普通价，还是vipPrice，都一股脑返回了，所以不用考虑v-if的权限不彻底，只需要不展示。）</p>
<p><strong>前端需求2与实现</strong></p>
<p>若用户是第二种<code>乐享会员pro</code>，当它分享小程序出去时，子级用户进入同样可以享受到私享价，即便他是默认的<code>漫享会员</code>。</p>
<p>这里需要做：</p>
<ol>
<li>分享时，判断用户是否是<code>乐享会员pro</code>，是则带上他的会员Id。</li>
<li>若上级是<code>乐享会员pro</code>，子级用户则存储该Id。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	定义getter：判断是否乐享会员pro</span></span><br><span class="line"><span class="comment">	决定用户分享链接中是否包含kolId</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_">isKol</span>(<span class="params">state</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> state.<span class="property">vip_info</span>?.<span class="property">userType</span>?.<span class="title function_">includes</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// computed 分享参数</span></span><br><span class="line"><span class="title function_">shareParam</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">isKol</span> ? <span class="string">`?kolId=<span class="subst">$&#123;<span class="variable language_">this</span>.vip_info.applyId&#125;</span>`</span> : <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生命周期：分享好友、朋友圈</span></span><br><span class="line"><span class="title function_">onShareAppMessage</span>(<span class="params"><span class="keyword">from</span>, to</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/pages/shop/shop&quot;</span> + <span class="variable language_">this</span>.<span class="property">shareParam</span>,</span><br><span class="line">        <span class="attr">imageUrl</span>: <span class="string">&quot;https://xxx.jpg&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">    <span class="title function_">onShareTimeline</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">            <span class="attr">query</span>: <span class="variable language_">this</span>.<span class="property">shareParam</span>.<span class="title function_">split</span>(<span class="string">&quot;?&quot;</span>)[<span class="number">1</span>],</span><br><span class="line">            <span class="attr">imageUrl</span>: <span class="string">&quot;https://xxx.jpg&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">        </span><br><span class="line"><span class="comment">// onLoad生命周期中</span></span><br><span class="line"><span class="comment">// setFatherKolId是Vuex mutations，存到本地</span></span><br><span class="line"><span class="keyword">if</span>(e.<span class="property">kolId</span>) <span class="variable language_">this</span>.<span class="title function_">setFatherKolId</span>(e.<span class="property">kolId</span>)</span><br></pre></td></tr></table></figure>

<p>那么，对于这种用户而言，仅凭会员类型他是无法享受私享价（vip价）的，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">因此，html结构需要v-<span class="keyword">if</span>判断：v-<span class="keyword">if</span>=<span class="string">&quot;hasPrivatePriceAuth || fatherKolId&quot;</span></span><br><span class="line">html内容（价格）需要判断：&#123;&#123; ( ((hasPrivatePriceAuth || fatherKolId) &amp;&amp; item.<span class="property">vipPrice</span>) || item.<span class="property">priceFee</span>) &#125;&#125;</span><br></pre></td></tr></table></figure>

<h6 id="基于需求1、2的后端实现"><a href="#基于需求1、2的后端实现" class="headerlink" title="基于需求1、2的后端实现"></a><em>基于需求1、2的后端实现</em></h6><p>以上只是价格的前端渲染，但实际支付的价格需要后端修改。</p>
<p>对此，前端需要在请求接口时，携带参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;isSharePrice&quot;</span>: <span class="title class_">Number</span>(<span class="variable language_">this</span>.<span class="property">hasPrivatePriceAuth</span> || <span class="title class_">Boolean</span>(<span class="variable language_">this</span>.<span class="property">fatherKolId</span>)),</span><br></pre></td></tr></table></figure>

<h6 id="购物车私享价字段的添加"><a href="#购物车私享价字段的添加" class="headerlink" title="购物车私享价字段的添加"></a><em>购物车私享价字段的添加</em></h6><p>对于从后端获取到的购物项数据而言，没有私享价该字段。（可后端改，可前端改）</p>
<p>具体讲，就是对于每个购物项的spuId和skuId，去首页的商品数据匹配，有则将首页商品数据中的私享价字段添加进购物车本地数据。这种情况考虑的是：重登时，若之前购物车中已有购物商品。</p>
<p>对于正常情况，则直接在添加购物车时，将私享价字段添加本地就行。</p>
<p>这样，在用户勾选购物项时，未勾选是正常价，勾选后是私享价（若是）。</p>
<p><strong>Bug：购物车已选私享价总金额0</strong></p>
<p>重新登录时，若之前已有购物项，同时用户有私享价权限，那么由于computed金额渲染到结构上时，没有私享价这个字段（尚未通过接口去查），就会得到结果0渲染。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">	页面 computed</span></span><br><span class="line"><span class="comment">    由于私享价是查sku得到的，在重登时若之前购物车有数据，</span></span><br><span class="line"><span class="comment">    payTotalPrivatePrice一开始为0</span></span><br><span class="line"><span class="comment">    @return payTotalPrivatePrice 私享价， payTotalPrice 正常价</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_">userTotalPrice</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">hasPrivatePriceAuth</span> || <span class="variable language_">this</span>.<span class="property">fatherKolId</span>) <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">payTotalPrivatePrice</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">payTotalPrice</span></span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	Vuex getter</span></span><br><span class="line"><span class="comment">	购物车已选商品的总金额（私享价）</span></span><br><span class="line"><span class="comment">	这里不加权限校验，由使用处校验</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_">payTotalPrivatePrice</span>(<span class="params">state</span>)&#123;</span><br><span class="line">	<span class="keyword">return</span> state.<span class="property">cartGoods</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">isChecked</span>)</span><br><span class="line">        .<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">sku_private_price</span> || <span class="number">0</span> * item.<span class="property">count</span>)</span><br><span class="line">        .<span class="title function_">reduce</span>(<span class="function">(<span class="params">prev, current</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> prev + current</span><br><span class="line">	&#125;, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那就会显示出一个<strong>Bug</strong>，重登时购物车全选，但私享价总和不符，必须要刷新。</p>
<p><strong>解决</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	对于页面中接口获取的购物车数据进行reduce遍历，获取私享价总和（此时已经是查到私享价数据后了）</span></span><br><span class="line"><span class="comment">	商品价格以这种形式渲染：&#123;&#123; userTotalPrice || appPrivatePrice &#125;&#125;</span></span><br><span class="line"><span class="comment">	如果 userTotalPrice 返回的是正常价，即使是0，那么也不会使用到已用权限if判断的appPrivatePrice（默认0）</span></span><br><span class="line"><span class="comment">					    返回的是私享价，若是0，那么就会用页面中的appPrivatePrice</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="attr">watch</span>: &#123;</span><br><span class="line">    <span class="attr">cartGoods</span>: &#123;</span><br><span class="line">        <span class="title function_">handler</span>(<span class="params">newV, oldV</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> sum = newV.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">isChecked</span>)</span><br><span class="line">            .<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">sku_private_price</span> || <span class="number">0</span> * item.<span class="property">count</span>)</span><br><span class="line">            .<span class="title function_">reduce</span>(<span class="function">(<span class="params">prev, current</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> prev + current</span><br><span class="line">            &#125;, <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">hasPrivatePriceAuth</span> || <span class="variable language_">this</span>.<span class="property">fatherKolId</span>) <span class="variable language_">this</span>.<span class="property">appPrivatePrice</span> = sum</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">immediate</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">deep</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li>
</ul>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="http://domain.com/awesome.mp3">
            </audio>
            
        </div>
        
        
    <div id="gitalk-container" class="comment link"
		data-enable="false"
        data-ae="false"
        data-ci=""
        data-cs=""
        data-r=""
        data-o=""
        data-a=""
        data-d="false"
    >查看评论</div>


    </div>
    
        <div class="side">
            <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E5%91%A8%EF%BC%882022-x2F-11-x2F-14-11-x2F-18%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">第一周（2022&#x2F;11&#x2F;14 - 11&#x2F;18）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday"><span class="toc-number">1.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday"><span class="toc-number">1.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday"><span class="toc-number">1.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday"><span class="toc-number">1.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday"><span class="toc-number">1.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%91%A8%EF%BC%8811-x2F-21-11-x2F-25%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">第二周（11&#x2F;21 - 11&#x2F;25）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-1"><span class="toc-number">2.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-1"><span class="toc-number">2.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-1"><span class="toc-number">2.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-1"><span class="toc-number">2.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-1"><span class="toc-number">2.0.5.</span> <span class="toc-text">Friday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">2.0.6.</span> <span class="toc-text">总结：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E5%91%A8%EF%BC%8811-x2F-28-12-x2F-2%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">第三周（11&#x2F;28 - 12&#x2F;2）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-Wednesday"><span class="toc-number">3.0.1.</span> <span class="toc-text">Monday - Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-2"><span class="toc-number">3.0.2.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-2"><span class="toc-number">3.0.3.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E5%91%A8%EF%BC%8812-x2F-5-12-x2F-9%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">第四周（12&#x2F;5 - 12&#x2F;9）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-2"><span class="toc-number">4.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-2"><span class="toc-number">4.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-2"><span class="toc-number">4.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-3"><span class="toc-number">4.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-3"><span class="toc-number">4.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E5%91%A8%EF%BC%8812-x2F-12-12-x2F-16%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">第五周（12&#x2F;12 - 12&#x2F;16）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-3"><span class="toc-number">5.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-3"><span class="toc-number">5.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-3"><span class="toc-number">5.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-4"><span class="toc-number">5.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-4"><span class="toc-number">5.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E5%91%A8%EF%BC%8812-x2F-19-12-x2F-23%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">第六周（12&#x2F;19 - 12&#x2F;23）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-4"><span class="toc-number">6.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-4"><span class="toc-number">6.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-Friday"><span class="toc-number">6.0.3.</span> <span class="toc-text">Wednesday - Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E5%91%A8%EF%BC%8812-x2F-26-12-x2F-30%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">第七周（12&#x2F;26 - 12&#x2F;30）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-5"><span class="toc-number">7.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-5"><span class="toc-number">7.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-4"><span class="toc-number">7.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-5"><span class="toc-number">7.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-5"><span class="toc-number">7.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%85%AB%E5%91%A8%EF%BC%882023-x2F-1-x2F-3-1-x2F-6%EF%BC%89"><span class="toc-number">8.</span> <span class="toc-text">第八周（2023&#x2F;1&#x2F;3 - 1&#x2F;6）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-6"><span class="toc-number">8.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-6"><span class="toc-number">8.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-5"><span class="toc-number">8.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-6"><span class="toc-number">8.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-6"><span class="toc-number">8.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B9%9D%E5%91%A8%EF%BC%881-x2F-9-1-x2F-13%EF%BC%89"><span class="toc-number">9.</span> <span class="toc-text">第九周（1&#x2F;9 - 1&#x2F;13）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-7"><span class="toc-number">9.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-7"><span class="toc-number">9.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-6"><span class="toc-number">9.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-7"><span class="toc-number">9.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-7"><span class="toc-number">9.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%91%A8%EF%BC%881-x2F-16-1-x2F-20%EF%BC%89"><span class="toc-number">10.</span> <span class="toc-text">第十周（1&#x2F;16 - 1&#x2F;20）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-8"><span class="toc-number">10.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-8"><span class="toc-number">10.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-7"><span class="toc-number">10.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-8"><span class="toc-number">10.0.4.</span> <span class="toc-text">Thursday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E5%91%A8%EF%BC%881-x2F-30-2-x2F-3%EF%BC%89"><span class="toc-number">11.</span> <span class="toc-text">第十一周（1&#x2F;30 - 2&#x2F;3）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-9"><span class="toc-number">11.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-9"><span class="toc-number">11.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-8"><span class="toc-number">11.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-9"><span class="toc-number">11.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-8"><span class="toc-number">11.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E5%91%A8%EF%BC%882-x2F-6-2-x2F-10%EF%BC%89"><span class="toc-number">12.</span> <span class="toc-text">第十二周（2&#x2F;6 - 2&#x2F;10）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-10"><span class="toc-number">12.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-10"><span class="toc-number">12.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-10"><span class="toc-number">12.0.3.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-9"><span class="toc-number">12.0.4.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%89%E5%91%A8%EF%BC%882-x2F-13-2-x2F-17%EF%BC%89"><span class="toc-number">13.</span> <span class="toc-text">第十三周（2&#x2F;13 - 2&#x2F;17）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-11"><span class="toc-number">13.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-11"><span class="toc-number">13.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-9"><span class="toc-number">13.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-11"><span class="toc-number">13.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-10"><span class="toc-number">13.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%9B%9B%E5%91%A8%EF%BC%882-x2F-20-2-x2F-24%EF%BC%89"><span class="toc-number">14.</span> <span class="toc-text">第十四周（2&#x2F;20 - 2&#x2F;24）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-12"><span class="toc-number">14.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-12"><span class="toc-number">14.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-10"><span class="toc-number">14.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-12"><span class="toc-number">14.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-11"><span class="toc-number">14.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%94%E5%91%A8%EF%BC%882-x2F-27-3-x2F-3%EF%BC%89"><span class="toc-number">15.</span> <span class="toc-text">第十五周（2&#x2F;27 - 3&#x2F;3）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-13"><span class="toc-number">15.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-13"><span class="toc-number">15.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-11"><span class="toc-number">15.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-13"><span class="toc-number">15.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-12"><span class="toc-number">15.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%85%AD%E5%91%A8%EF%BC%883-x2F-6-3-x2F-10%EF%BC%89"><span class="toc-number">16.</span> <span class="toc-text">第十六周（3&#x2F;6 - 3&#x2F;10）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-14"><span class="toc-number">16.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-14"><span class="toc-number">16.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-12"><span class="toc-number">16.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-14"><span class="toc-number">16.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-13"><span class="toc-number">16.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%83%E5%91%A8%EF%BC%883-x2F-13-3-x2F-17%EF%BC%89"><span class="toc-number">17.</span> <span class="toc-text">第十七周（3&#x2F;13 - 3&#x2F;17）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-15"><span class="toc-number">17.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-15"><span class="toc-number">17.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-13"><span class="toc-number">17.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-15"><span class="toc-number">17.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-14"><span class="toc-number">17.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%85%AB%E5%91%A8%EF%BC%883-x2F-20-3-x2F-25%EF%BC%89"><span class="toc-number">18.</span> <span class="toc-text">第十八周（3&#x2F;20 - 3&#x2F;25）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-16"><span class="toc-number">18.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-16"><span class="toc-number">18.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-Friday-1"><span class="toc-number">18.0.3.</span> <span class="toc-text">Wednesday - Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B9%9D%E5%91%A8%EF%BC%883-x2F-27-3-x2F-31%EF%BC%89"><span class="toc-number">19.</span> <span class="toc-text">第十九周（3&#x2F;27 - 3&#x2F;31）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-17"><span class="toc-number">19.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-17"><span class="toc-number">19.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-14"><span class="toc-number">19.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-16"><span class="toc-number">19.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-15"><span class="toc-number">19.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%8D%81%E5%91%A8%EF%BC%884-x2F-3-4-x2F-7%EF%BC%89"><span class="toc-number">20.</span> <span class="toc-text">第二十周（4&#x2F;3 - 4&#x2F;7）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-18"><span class="toc-number">20.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-18"><span class="toc-number">20.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-15"><span class="toc-number">20.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-17"><span class="toc-number">20.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-16"><span class="toc-number">20.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%B8%80%E5%91%A8%EF%BC%884-x2F-10-4-x2F-14%EF%BC%89"><span class="toc-number">21.</span> <span class="toc-text">第二十一周（4&#x2F;10 - 4&#x2F;14）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-19"><span class="toc-number">21.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-19"><span class="toc-number">21.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-16"><span class="toc-number">21.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-18"><span class="toc-number">21.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-17"><span class="toc-number">21.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%BA%8C%E5%91%A8%EF%BC%884-x2F-17-4-x2F-21%EF%BC%89"><span class="toc-number">22.</span> <span class="toc-text">第二十二周（4&#x2F;17 - 4&#x2F;21）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-20"><span class="toc-number">22.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-20"><span class="toc-number">22.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-17"><span class="toc-number">22.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-19"><span class="toc-number">22.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-18"><span class="toc-number">22.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%B8%89%E5%91%A8%EF%BC%884-x2F-23-4-x2F-28%EF%BC%89"><span class="toc-number">23.</span> <span class="toc-text">第二十三周（4&#x2F;23 - 4&#x2F;28）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Weekday"><span class="toc-number">23.0.1.</span> <span class="toc-text">Weekday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-21"><span class="toc-number">23.0.2.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-21"><span class="toc-number">23.0.3.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-18"><span class="toc-number">23.0.4.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-Friday"><span class="toc-number">23.0.5.</span> <span class="toc-text">Thursday - Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%8D%81%E5%9B%9B%E5%91%A8%EF%BC%885-x2F-4-5-x2F-6%EF%BC%89"><span class="toc-number">24.</span> <span class="toc-text">第二十四周（5&#x2F;4 - 5&#x2F;6）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-20"><span class="toc-number">24.0.1.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-19"><span class="toc-number">24.0.2.</span> <span class="toc-text">Friday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Saturday"><span class="toc-number">24.0.3.</span> <span class="toc-text">Saturday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%BA%94%E5%91%A8%EF%BC%885-x2F-8-5-x2F-12%EF%BC%89"><span class="toc-number">25.</span> <span class="toc-text">第二十五周（5&#x2F;8 - 5&#x2F;12）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-22"><span class="toc-number">25.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-22"><span class="toc-number">25.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-19"><span class="toc-number">25.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-21"><span class="toc-number">25.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-20"><span class="toc-number">25.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%8D%81%E5%85%AD%E5%91%A8%EF%BC%885-x2F-15-5-x2F-19%EF%BC%89"><span class="toc-number">26.</span> <span class="toc-text">第二十六周（5&#x2F;15 - 5&#x2F;19）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-23"><span class="toc-number">26.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-23"><span class="toc-number">26.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-20"><span class="toc-number">26.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-22"><span class="toc-number">26.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-21"><span class="toc-number">26.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%B8%83%E5%91%A8%EF%BC%885-x2F-22-5-x2F-26%EF%BC%89"><span class="toc-number">27.</span> <span class="toc-text">第二十七周（5&#x2F;22 - 5&#x2F;26）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-24"><span class="toc-number">27.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-24"><span class="toc-number">27.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-21"><span class="toc-number">27.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-23"><span class="toc-number">27.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-22"><span class="toc-number">27.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%8D%81%E5%85%AB%E5%91%A8%EF%BC%885-x2F-29-6-x2F-2%EF%BC%89"><span class="toc-number">28.</span> <span class="toc-text">第二十八周（5&#x2F;29 - 6&#x2F;2）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-25"><span class="toc-number">28.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-25"><span class="toc-number">28.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-22"><span class="toc-number">28.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-24"><span class="toc-number">28.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-23"><span class="toc-number">28.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%B9%9D%E5%91%A8%EF%BC%886-x2F-5-6-x2F-9%EF%BC%89"><span class="toc-number">29.</span> <span class="toc-text">第二十九周（6&#x2F;5 - 6&#x2F;9）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-26"><span class="toc-number">29.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-26"><span class="toc-number">29.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-23"><span class="toc-number">29.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-25"><span class="toc-number">29.0.4.</span> <span class="toc-text">Thursday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Friday-24"><span class="toc-number">29.0.5.</span> <span class="toc-text">Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E5%8D%81%E5%91%A8%EF%BC%886-x2F-12-6-x2F-16%EF%BC%89"><span class="toc-number">30.</span> <span class="toc-text">第三十周（6&#x2F;12 - 6&#x2F;16）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-27"><span class="toc-number">30.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-Wednesday"><span class="toc-number">30.0.2.</span> <span class="toc-text">Tuesday - Wednesday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E5%8D%81%E4%B8%80%E5%91%A8%EF%BC%886-x2F-19-6-x2F-21%EF%BC%89"><span class="toc-number">31.</span> <span class="toc-text">第三十一周（6&#x2F;19 - 6&#x2F;21）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-Wednesday-1"><span class="toc-number">31.0.1.</span> <span class="toc-text">Monday - Wednesday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E5%8D%81%E4%BA%8C%E5%91%A8%EF%BC%886-x2F-26-6-x2F-30%EF%BC%89"><span class="toc-number">32.</span> <span class="toc-text">第三十二周（6&#x2F;26 - 6&#x2F;30）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-28"><span class="toc-number">32.0.1.</span> <span class="toc-text">Monday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tuesday-27"><span class="toc-number">32.0.2.</span> <span class="toc-text">Tuesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Wednesday-24"><span class="toc-number">32.0.3.</span> <span class="toc-text">Wednesday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Thursday-Friday-1"><span class="toc-number">32.0.4.</span> <span class="toc-text">Thursday - Friday</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E5%8D%81%E4%B8%89%E5%91%A8%EF%BC%887-x2F-3-7-x2F-7%EF%BC%89"><span class="toc-number">33.</span> <span class="toc-text">第三十三周（7&#x2F;3 - 7&#x2F;7）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Monday-Friday"><span class="toc-number">33.0.1.</span> <span class="toc-text">Monday - Friday</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E9%9C%80%E6%B1%821%E3%80%812%E7%9A%84%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">33.0.2.</span> <span class="toc-text">基于需求1、2的后端实现</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6%E7%A7%81%E4%BA%AB%E4%BB%B7%E5%AD%97%E6%AE%B5%E7%9A%84%E6%B7%BB%E5%8A%A0"><span class="toc-number">33.0.3.</span> <span class="toc-text">购物车私享价字段的添加</span></a></li></ol></li></ol></li></ol>
        </div>
    
</div>


    </div>
</div>
</body>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
